

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Chapitre 4 - La préparation des données et les premières statistiques (2ème partie) &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '04_02_manipulation_description_des_donnees';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Chapitre 5 - La data visualisation avec Python (1ère partie)" href="05_01_Data_visualisation_matplotlib_seaborn.html" />
    <link rel="prev" title="Chapitre 4 - La préparation des données et les premières statistiques (1ère partie)" href="04_01_recuperation_des_donnees.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
  
    <p class="title logo__title">My sample book</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Bienvenue sur le site de TRA BI NENE OTHNIEL
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="markdown.html">Markdown Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks.html">Content with notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="markdown-notebooks.html">Notebooks with MyST Markdown</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter2.html">mes recherches et tout ce qui est utiles</a></li>

<li class="toctree-l1"><a class="reference internal" href="02_python_from_scratch.html">Chapitre 2 - Les bases de Python / Python from scratch</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_numpy_pandas_bases.html">Chapitre 3 - Python et les données (NumPy et Pandas)</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_01_recuperation_des_donnees.html">Chapitre 4 - La préparation des données et les premières statistiques (1ère partie)</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Chapitre 4 - La préparation des données et les premières statistiques (2ème partie)</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_01_Data_visualisation_matplotlib_seaborn.html">Chapitre 5 - La data visualisation avec Python (1ère partie)</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_02_Data_visualisation_cartographie.html">Chapitre 5 - La data visualisation avec Python (2ème partie)</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_03_Visualisations_interactives.html">Chapitre 5 - La data visualisation avec Python (1ère partie)</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_01_Machine_learning_supervise.html">Chapitre 6 - Différentes utilisations dumachine learning avec Python (1ère partie)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Random%20Forest.html">librairies de base</a></li>






<li class="toctree-l1"><a class="reference internal" href="06_02_Machine_learning_non_supervise.html">Chapitre 6 - Différentes utilisations du machine learning avec Python (2ème partie)</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_03_NLP.html">Chapitre 6 - Différentes utilisations du machine learning avec Python (3ème partie)</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_04_Deep_Learning.html">Chapitre 6 - Différentes utilisations dumachine learning avec Python (4ème partie)</a></li>
<li class="toctree-l1"><a class="reference internal" href="07_01_Big_data_import.html">Chapitre 7 - Passage au big data (1ère partie)</a></li>
<li class="toctree-l1"><a class="reference internal" href="07_02_Spark.html">Chapitre 7 - Passage au big data (2ème partie)</a></li>
<li class="toctree-l1"><a class="reference internal" href="CAA_test-checkpoint.html">1. Modelisation des rendements</a></li>

<li class="toctree-l1"><a class="reference internal" href="FORMATION%20PYTHON-checkpoint.html">Introduction</a></li>






<li class="toctree-l1"><a class="reference internal" href="Introduction%20%C3%A0%20Scikit%20Learn-checkpoint.html">Introduction à Scikit Learn</a></li>
<li class="toctree-l1"><a class="reference internal" href="Python%20vs%20R-checkpoint.html">Python vs R : le duel</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2F04_02_manipulation_description_des_donnees.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/04_02_manipulation_description_des_donnees.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Chapitre 4 - La préparation des données et les premières statistiques (2ème partie)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decrire-et-transformer-des-colonnes">4.3 Décrire et transformer des colonnes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#d-ecrire-la-structure-de-vos-donnees">4.3.1 D écrire la structure de vos données</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#quelles-transformations-pour-les-colonnes-de-vos-donnees">4.3.2 Quelles transformations pour les colonnes de vos données ?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#les-changements-de-types">4.3.3 Les changements de types</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#les-jointures-et-concatenations">4.3.4 Les jointures et concaténations</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#les-jointures-entre-dataframe">Les jointures entre DataFrame</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#la-gestion-des-duplications-de-lignes">4.3.4 La gestion des duplications de lignes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#la-discretisation">4.3.5 La discrétisation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#intervalles-constants">Intervalles constants</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#intervalles-definis-par-lutilisateur">Intervalles définis par l’utilisateur</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#intervalles-de-frequence-constante">Intervalles de fréquence constante</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#les-tris">4.3.6 Les tris</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#le-tri-de-numpy">Le tri de NumPy</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#le-tri-de-pandas">Le tri de Pandas</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#le-traitement-de-donnees-temporelles">4.3.7 Le traitement de données temporelles</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#les-dates-avec-numpy">Les dates avec NumPy</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#les-dates-avec-pandas">Les dates avec Pandas</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#le-traitement-des-donnees-manquantes">4.3.8 Le traitement des données manquantes</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#les-donnees-manquantes-en-python">Les données manquantes en Python</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#la-suppression-des-donnees-manquantes">La suppression des données manquantes</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#la-completion-par-la-moyenne-le-mode-ou-la-mediane">La complétion par la moyenne, le mode ou la médiane</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#le-traitement-des-colonnes-avec-des-donnees-qualitatives">4.3.9 Le traitement des colonnes avec des données qualitatives</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#le-type-categorical">Le type categorical</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#la-transformation-des-donnees">La transformation des données</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#approche-pandas-avec-get-dummies">Approche Pandas avec get_dummies() :</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#approche-scikit-learn-avec-onehotencoder">Approche Scikit-Learn avec OneHotEncoder() :</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#approche-avec-pandas">Approche avec Pandas :</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#approche-avec-scikit-learn">Approche avec Scikit-Learn :</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#les-transformations-numeriques">4.3.10 Les transformations numériques</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#centrer-et-reduire-les-donnees">Centrer et réduire les données</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#changer-dechelle">Changer d’échelle</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#transformation-de-box-cox">Transformation de Box-Cox</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#echantillonnage-des-donnees">4.3.11 Echantillonnage des données</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#la-construction-de-tableaux-croises">4.3.12 La construction de tableaux croisés</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extraire-des-statistiques-descriptives">4.4 Extraire des statistiques descriptives</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#statistiques-pour-donnees-quantitatives">4.4.1 Statistiques pour données quantitatives</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#des-statistiques-plus-avancees">Des statistiques plus avancées</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#statistiques-pour-donnees-qualitatives">4.4.2 Statistiques pour données qualitatives</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#utilisation-du-groupby-pour-decrire-des-donnees">4.5 Utilisation du groupby pour décrire des données</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#le-principe">4.5.1 Le principe</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#les-operations-sur-les-objets-groupby">4.5.2 Les opérations sur les objets groupby</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#apply-une-methode-importante-pour-manipuler-vos-groupby">4.5.3 Apply : une méthode importante pour manipuler vos groupby</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cas-concret-dutilisation-dun-groupby">4.5.4 Cas concret d’utilisation d’un groupby</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="chapitre-4-la-preparation-des-donnees-et-les-premieres-statistiques-2eme-partie">
<h1>Chapitre 4 - La préparation des données et les premières statistiques (2ème partie)<a class="headerlink" href="#chapitre-4-la-preparation-des-donnees-et-les-premieres-statistiques-2eme-partie" title="Permalink to this heading">#</a></h1>
<p>Avant de rentrer dans le détail de ce chapitre, nous allons commencer par charger les packages et importer les données nécessaies aux traitements.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
<p>Données AirBnB</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import d&#39;un extrait</span>
<span class="n">listing</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/listing_extrait.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">calendar</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/calendar_extrait.csv&quot;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Import du fichier complet</span>
<span class="c1">#listing = pd.read_csv(&quot;https://www.stat4decision.com/listings.csv.gz&quot;, index_col=0)</span>
<span class="c1">#calendar = pd.read_csv(&quot;https://www.stat4decision.com/calendar.csv.gz&quot;, index_col=0)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Import d&#39;un extrait</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">listing</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/listing_extrait.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">calendar</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/calendar_extrait.csv&quot;</span><span class="p">,</span><span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="nn">File ~\anaconda3\lib\site-packages\pandas\util\_decorators.py:211,</span> in <span class="ni">deprecate_kwarg.&lt;locals&gt;._deprecate_kwarg.&lt;locals&gt;.wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">209</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">210</span>         <span class="n">kwargs</span><span class="p">[</span><span class="n">new_arg_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_arg_value</span>
<span class="ne">--&gt; </span><span class="mi">211</span> <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~\anaconda3\lib\site-packages\pandas\util\_decorators.py:331,</span> in <span class="ni">deprecate_nonkeyword_arguments.&lt;locals&gt;.decorate.&lt;locals&gt;.wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">325</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">num_allow_args</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">326</span>     <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">327</span>         <span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arguments</span><span class="o">=</span><span class="n">_format_argument_list</span><span class="p">(</span><span class="n">allow_args</span><span class="p">)),</span>
<span class="g g-Whitespace">    </span><span class="mi">328</span>         <span class="ne">FutureWarning</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">329</span>         <span class="n">stacklevel</span><span class="o">=</span><span class="n">find_stack_level</span><span class="p">(),</span>
<span class="g g-Whitespace">    </span><span class="mi">330</span>     <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">331</span> <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~\anaconda3\lib\site-packages\pandas\io\parsers\readers.py:950,</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, squeeze, prefix, mangle_dupe_cols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, error_bad_lines, warn_bad_lines, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">935</span> <span class="n">kwds_defaults</span> <span class="o">=</span> <span class="n">_refine_defaults_read</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">936</span>     <span class="n">dialect</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">937</span>     <span class="n">delimiter</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">946</span>     <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;delimiter&quot;</span><span class="p">:</span> <span class="s2">&quot;,&quot;</span><span class="p">},</span>
<span class="g g-Whitespace">    </span><span class="mi">947</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">948</span> <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">950</span> <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

<span class="nn">File ~\anaconda3\lib\site-packages\pandas\io\parsers\readers.py:605,</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">602</span> <span class="n">_validate_names</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;names&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">604</span> <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">605</span> <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">607</span> <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">608</span>     <span class="k">return</span> <span class="n">parser</span>

<span class="nn">File ~\anaconda3\lib\site-packages\pandas\io\parsers\readers.py:1442,</span> in <span class="ni">TextFileReader.__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">   </span><span class="mi">1439</span>     <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">   </span><span class="mi">1441</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="p">:</span> <span class="n">IOHandles</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="ne">-&gt; </span><span class="mi">1442</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>

<span class="nn">File ~\anaconda3\lib\site-packages\pandas\io\parsers\readers.py:1735,</span> in <span class="ni">TextFileReader._make_engine</span><span class="nt">(self, f, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1733</span>     <span class="k">if</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1734</span>         <span class="n">mode</span> <span class="o">+=</span> <span class="s2">&quot;b&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1735</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="o">=</span> <span class="n">get_handle</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1736</span>     <span class="n">f</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1737</span>     <span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1738</span>     <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1739</span>     <span class="n">compression</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;compression&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1740</span>     <span class="n">memory_map</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_map&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1741</span>     <span class="n">is_text</span><span class="o">=</span><span class="n">is_text</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1742</span>     <span class="n">errors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;encoding_errors&quot;</span><span class="p">,</span> <span class="s2">&quot;strict&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1743</span>     <span class="n">storage_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;storage_options&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1744</span> <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1745</span> <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">   </span><span class="mi">1746</span> <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span><span class="o">.</span><span class="n">handle</span>

<span class="nn">File ~\anaconda3\lib\site-packages\pandas\io\common.py:856,</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">851</span> <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">852</span>     <span class="c1"># Check whether the filename is to be opened in binary mode.</span>
<span class="g g-Whitespace">    </span><span class="mi">853</span>     <span class="c1"># Binary mode does not support &#39;encoding&#39; and &#39;newline&#39;.</span>
<span class="g g-Whitespace">    </span><span class="mi">854</span>     <span class="k">if</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span> <span class="ow">and</span> <span class="s2">&quot;b&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">855</span>         <span class="c1"># Encoding</span>
<span class="ne">--&gt; </span><span class="mi">856</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">857</span>             <span class="n">handle</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">858</span>             <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">859</span>             <span class="n">encoding</span><span class="o">=</span><span class="n">ioargs</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">860</span>             <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">861</span>             <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">862</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">863</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">864</span>         <span class="c1"># Binary mode</span>
<span class="g g-Whitespace">    </span><span class="mi">865</span>         <span class="n">handle</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">ioargs</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;../data/listing_extrait.csv&#39;
</pre></div>
</div>
</div>
</div>
<p>Données sur les employés de la ville de Boston</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boston</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;../data/employee-earnings-report-2017.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="decrire-et-transformer-des-colonnes">
<h2>4.3 Décrire et transformer des colonnes<a class="headerlink" href="#decrire-et-transformer-des-colonnes" title="Permalink to this heading">#</a></h2>
<section id="d-ecrire-la-structure-de-vos-donnees">
<h3>4.3.1 D écrire la structure de vos données<a class="headerlink" href="#d-ecrire-la-structure-de-vos-donnees" title="Permalink to this heading">#</a></h3>
<p>Quel que soit le type de structure que vous utilisez ; les arrays, les Series ou
les DataFrame, on utilise généralement une propriété de ces objets : la propriété
.shape. Celle-ci renvoie toujours un tuple, qui aura autant d’éléments que de dimensions
dans vos données.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">calendar</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(10000, 6)
</pre></div>
</div>
</div>
</div>
<p>Cette information est importante mais reste peu détaillée. Lorsqu’on travaille sur
un DataFrame, on va chercher à avoir beaucoup plus de détails. Pour cela, nous allons
utiliser la méthode .info(). Si nous prenons le jeu de données des occupations des
logements AirBnB, nous aurons :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">calendar</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 10000 entries, 2577 to 9359
Data columns (total 6 columns):
 #   Column          Non-Null Count  Dtype  
---  ------          --------------  -----  
 0   date            10000 non-null  object 
 1   available       10000 non-null  object 
 2   price           10000 non-null  object 
 3   adjusted_price  10000 non-null  object 
 4   minimum_nights  9995 non-null   float64
 5   maximum_nights  9995 non-null   float64
dtypes: float64(2), object(4)
memory usage: 546.9+ KB
</pre></div>
</div>
</div>
</div>
<p>Une autre étape importante est l’étude de l’aspect de notre DataFrame, on peut
par exemple afficher les premières lignes du jeu de données.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">calendar</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>available</th>
      <th>price</th>
      <th>adjusted_price</th>
      <th>minimum_nights</th>
      <th>maximum_nights</th>
    </tr>
    <tr>
      <th>listing_id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2577</th>
      <td>2020-10-19</td>
      <td>f</td>
      <td>$125.00</td>
      <td>$125.00</td>
      <td>3.0</td>
      <td>1125.0</td>
    </tr>
    <tr>
      <th>73533</th>
      <td>2020-10-20</td>
      <td>t</td>
      <td>$95.00</td>
      <td>$95.00</td>
      <td>2.0</td>
      <td>1125.0</td>
    </tr>
    <tr>
      <th>73533</th>
      <td>2020-10-21</td>
      <td>t</td>
      <td>$95.00</td>
      <td>$95.00</td>
      <td>2.0</td>
      <td>1125.0</td>
    </tr>
    <tr>
      <th>73533</th>
      <td>2020-10-22</td>
      <td>t</td>
      <td>$95.00</td>
      <td>$95.00</td>
      <td>2.0</td>
      <td>1125.0</td>
    </tr>
    <tr>
      <th>73533</th>
      <td>2020-10-23</td>
      <td>t</td>
      <td>$95.00</td>
      <td>$95.00</td>
      <td>2.0</td>
      <td>1125.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Une autre propriété importante des DataFrame de Pandas est .columns. En effet, celle-ci a deux utilités :</p>
<ul class="simple">
<li><p>afficher le nom des colonnes de votre DataFrame,</p></li>
<li><p>créer une structure permettant d’avoir une liste des colonnes que nous pourrons utiliser pour des automatisations.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">calendar</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;date&#39;, &#39;available&#39;, &#39;price&#39;, &#39;adjusted_price&#39;, &#39;minimum_nights&#39;,
       &#39;maximum_nights&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># on peut faire une boucle sur les colonnes de notre DataFrame</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">calendar</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">calendar</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot; : &quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>date : object
available : object
price : object
adjusted_price : object
minimum_nights : float64
maximum_nights : float64
</pre></div>
</div>
</div>
</div>
</section>
<section id="quelles-transformations-pour-les-colonnes-de-vos-donnees">
<h3>4.3.2 Quelles transformations pour les colonnes de vos données ?<a class="headerlink" href="#quelles-transformations-pour-les-colonnes-de-vos-donnees" title="Permalink to this heading">#</a></h3>
<p>Votre objectif en tant que data scientist est d’extraire le plus d’information possible de ces données. Pour cela, il va falloir les mettre en forme de manière intelligente.</p>
<p>Nous allons étudier différentes transformations nécessaires pour travailler sur des données :</p>
<ul class="simple">
<li><p>les changements de types,</p></li>
<li><p>les jointures,</p></li>
<li><p>la discrétisation,</p></li>
<li><p>le traitement de données temporelles,</p></li>
<li><p>les transformations numériques,</p></li>
<li><p>le traitement des colonnes avec des données qualitatives,</p></li>
<li><p>le traitement des données manquantes,</p></li>
<li><p>la construction de tableaux croisés.</p></li>
</ul>
</section>
<section id="les-changements-de-types">
<h3>4.3.3 Les changements de types<a class="headerlink" href="#les-changements-de-types" title="Permalink to this heading">#</a></h3>
<p>Le typage des colonnes d’un DataFrame ou d’un array est très important pour tous les traitements en data science.</p>
<p>Nous nous concentrons ici sur les structures en DataFrame de Pandas. Pandas va automatiquement inférer les types si vous ne lui avez pas spécifié de type à l’importation
des données ou à la création du DataFrame.</p>
<p>Par défaut, Pandas va utiliser trois types principaux :</p>
<ul class="simple">
<li><p>les entiers int en 32 ou en 64 bits,</p></li>
<li><p>les nombres décimaux float en 32 ou 64 bits,</p></li>
<li><p>les objets object qui rassemblent la plupart des autres types.</p></li>
</ul>
<p>On trouvera aussi des booléens et tous les types définis par NumPy.</p>
<p>La base de données listing de AirBnB est obtenue par scrapping web et certaines informations ne peuvent pas être traitées directement. En effet, lorsqu’on affiche les
informations sur les colonnes, on voit que la colonne price est typée en Object alors qu’il s’agit de valeurs décimales.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>id
2577    $125.00
3109     $60.00
4886     $89.00
4890    $103.00
5396     $48.00
Name: price, dtype: object
</pre></div>
</div>
</div>
</div>
<p>Pour nous débarrasser du $ en première position, nous avons trois possibilités :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># élimine le premier élément</span>
<span class="o">%</span><span class="k">timeit</span> listing[&quot;price&quot;].str[1 :]
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.39 ms ± 109 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># remplace tous les $</span>
<span class="o">%</span><span class="k">timeit</span> listing[&quot;price&quot;].str.replace(&quot;$&quot;,&quot;&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.86 ms ± 164 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#élimine le premier élément lorsque c’est un $</span>
<span class="o">%</span><span class="k">timeit</span> listing[&quot;price&quot;].str.strip(&quot;$&quot;)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.61 ms ± 85.3 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
</pre></div>
</div>
</div>
</div>
<p>On voit que ces trois approches sont assez différentes, la première est la plus
efficace en termes de temps de calcul mais elle est aussi la plus dangereuse en cas
d’erreur dans nos données.</p>
<p>Il reste deux étapes à réaliser : éliminer les virgules et transformer la variable en
variable numérique :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>float64
</pre></div>
</div>
</div>
</div>
<p>Nous avons donc réussi à modifier notre colonne.</p>
<p>Si nous désirons automatiser ce traitement, il suffit de créer une boucle sur les colonnes. On utilise le code suivant :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">listing</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">listing</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">==</span><span class="nb">object</span> <span class="p">:</span>
        <span class="n">listing</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">listing</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">)</span>\
                                                <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>On a utilisé le paramètre errors de la fonction to_numeric. Celui-ci sert à gérer les erreurs. Par exemple, lorsque Pandas n’arrive pas à faire la transformation en numérique, il renvoie une erreur par défaut. Dans notre cas, il est évident que certaines variables sont des objets qui ne pourront pas être transformés en variables numérique. Pour ces cas, on utilise errors = “ignore”, qui permet de ne pas faire la transformation tout en continuant l’exécution.</p>
<p>Si on étudie la colonne “instant_bookable”, on veut pouvoir prendre en compte cette colonne pour la passer en booléen :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># approche avec NumPy</span>
<span class="n">listing</span><span class="p">[</span><span class="s2">&quot;instant_bookable_bool&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">listing</span><span class="p">[</span><span class="s2">&quot;instant_bookable&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> 
    <span class="kc">False</span><span class="p">,</span> 
    <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># approche avec un dictionnaire et Pandas</span>
<span class="n">listing</span><span class="p">[</span><span class="s2">&quot;instant_bookable_bool2&quot;</span><span class="p">]</span><span class="o">=</span> <span class="n">listing</span><span class="p">[</span><span class="s2">&quot;instant_bookable&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;f&quot;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span><span class="s2">&quot;t&quot;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>On voit dans ce code que lorsqu’on veut remplacer deux valeurs, l’utilisation de la
fonction np.where de NumPy peut être une solution, mais il faut être attentif aux
risques liés à des mauvais codages de la variable.</p>
<p>Il existe de nombreux cas de nettoyages de données basées sur des erreurs de
typage. Ce que nous allons voir dans tout ce chapitre pourra vous aider à répondre à
vos problématiques spécifiques.</p>
</section>
<section id="les-jointures-et-concatenations">
<h3>4.3.4 Les jointures et concaténations<a class="headerlink" href="#les-jointures-et-concatenations" title="Permalink to this heading">#</a></h3>
<section id="les-jointures-entre-dataframe">
<h4>Les jointures entre DataFrame<a class="headerlink" href="#les-jointures-entre-dataframe" title="Permalink to this heading">#</a></h4>
<p>Les jointures entre DataFrame sont un outil puissant de Pandas qui ressemble
aux outils disponibles en SQL. Une jointure consiste à construire, à partir de deux
DataFrame, un DataFrame en utilisant ce qu’on appelle une clé de jointure qui sera
un identifiant des lignes présent dans les deux DataFrame initiaux.</p>
<p>La fonction de jointure de Pandas est la fonction pd.merge(). Elle prend comme
paramètres deux objets DataFrame puis des paramètres optionnels :</p>
<ul class="simple">
<li><p>on : choix de la ou des clés de jointure.</p></li>
<li><p>how : choix de la méthode de jointure. Il faut choisir entre left, right, inner et outer.</p></li>
<li><p>left_on (et right_on) : si les clés de jointure n’ont pas le même nom d’une table à une autre.</p></li>
<li><p>index_left (et index_right) : on donnera ici un booléen si l’index du DataFrame est utilisé comme clé.</p></li>
</ul>
<p>Sur les données AirBnB, nous utiliserons une jointure interne afin d’associer les
calendriers des  logements :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">global_airbnb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">listing</span><span class="p">,</span> 
                         <span class="n">calendar</span><span class="p">,</span> 
                         <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                         <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span>
                        <span class="p">)</span>
<span class="n">global_airbnb</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(10000, 81)
</pre></div>
</div>
</div>
</div>
<p>On voit ici qu’on a rassemblé les colonnes des deux DataFrame. Dans ce cas, le
DataFrame calendar est beaucoup plus grand que listing, le DataFrame obtenu ne
rassemble que les clés communes aux deux DataFrame mais lorsqu’il y a plusieurs
répétitions d’une clé, la combinaison est répétée.</p>
</section>
</section>
<section id="la-gestion-des-duplications-de-lignes">
<h3>4.3.4 La gestion des duplications de lignes<a class="headerlink" href="#la-gestion-des-duplications-de-lignes" title="Permalink to this heading">#</a></h3>
<p>Il arrive souvent dans des données que des lignes soient dupliquées par erreur ou que vous désiriez vérifier la duplication de certaines lignes.</p>
<p>Pandas possède deux outils pour traiter ce type de données : duplicated() et drop_duplicated().</p>
<p>Si nous voulons vérifier si des lignes sont dupliquées dans le DataFrame sur les employés de la ville de Boston, il nous suffit de faire :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boston</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<p>Il s’avère qu’il n’y a aucune duplication. Nous aurions pu nous concentrer uniquement
sur le nom, le département et le titre des employés :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boston</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">,</span><span class="s1">&#39;DEPARTMENT NAME&#39;</span><span class="p">,</span><span class="s1">&#39;TITLE&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># on a donc quatre éléments dupliqués, on peut maintenant les visualiser :</span>
<span class="n">boston</span><span class="p">[</span><span class="n">boston</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">,</span><span class="s1">&#39;DEPARTMENT NAME&#39;</span><span class="p">,</span><span class="s1">&#39;TITLE&#39;</span><span class="p">],</span> 
    <span class="n">keep</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>NAME</th>
      <th>DEPARTMENT NAME</th>
      <th>TITLE</th>
      <th>REGULAR</th>
      <th>RETRO</th>
      <th>OTHER</th>
      <th>OVERTIME</th>
      <th>INJURED</th>
      <th>DETAIL</th>
      <th>QUINN/EDUCATION INCENTIVE</th>
      <th>TOTAL EARNINGS</th>
      <th>POSTAL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>608</th>
      <td>Doherty,Brian J</td>
      <td>Boston Police Department</td>
      <td>Police Officer</td>
      <td>$100,210.65</td>
      <td>$1,491.90</td>
      <td>$4,400.03</td>
      <td>$14,576.76</td>
      <td>NaN</td>
      <td>$52,624.00</td>
      <td>NaN</td>
      <td>$173,303.34</td>
      <td>2122</td>
    </tr>
    <tr>
      <th>6097</th>
      <td>McCarthy,Kevin M</td>
      <td>Boston Fire Department</td>
      <td>Fire Lieutenant</td>
      <td>$133,038.18</td>
      <td>NaN</td>
      <td>$3,474.55</td>
      <td>$14,578.21</td>
      <td>NaN</td>
      <td>$4,381.50</td>
      <td>NaN</td>
      <td>$155,472.44</td>
      <td>2184</td>
    </tr>
    <tr>
      <th>6504</th>
      <td>McCarthy,Kevin M</td>
      <td>Boston Fire Department</td>
      <td>Fire Lieutenant</td>
      <td>$57,947.80</td>
      <td>NaN</td>
      <td>$1,835.94</td>
      <td>$22,557.60</td>
      <td>$67,211.54</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>$149,552.88</td>
      <td>2043</td>
    </tr>
    <tr>
      <th>7871</th>
      <td>Flynn,Robert</td>
      <td>Boston Police Department</td>
      <td>Police Officer</td>
      <td>$91,822.47</td>
      <td>$7,289.39</td>
      <td>$4,853.52</td>
      <td>$67,548.83</td>
      <td>NaN</td>
      <td>$828.00</td>
      <td>NaN</td>
      <td>$172,342.21</td>
      <td>2124</td>
    </tr>
    <tr>
      <th>11757</th>
      <td>Kelly,Michael Joseph</td>
      <td>Boston Fire Department</td>
      <td>Fire Fighter</td>
      <td>$105,118.72</td>
      <td>NaN</td>
      <td>$550.00</td>
      <td>$9,273.38</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>$114,942.10</td>
      <td>2122</td>
    </tr>
    <tr>
      <th>16249</th>
      <td>Kelly,Michael Joseph</td>
      <td>Boston Fire Department</td>
      <td>Fire Fighter</td>
      <td>$83,457.62</td>
      <td>NaN</td>
      <td>$550.00</td>
      <td>$13,921.51</td>
      <td>$8,705.64</td>
      <td>$19,408.00</td>
      <td>NaN</td>
      <td>$126,042.77</td>
      <td>2132</td>
    </tr>
    <tr>
      <th>16618</th>
      <td>Flynn,Robert</td>
      <td>Boston Police Department</td>
      <td>Police Officer</td>
      <td>$52,689.10</td>
      <td>$1,411.01</td>
      <td>$800.00</td>
      <td>$19,674.52</td>
      <td>$32,146.74</td>
      <td>$28,198.00</td>
      <td>NaN</td>
      <td>$134,919.37</td>
      <td>2122</td>
    </tr>
    <tr>
      <th>17639</th>
      <td>Doherty,Brian J</td>
      <td>Boston Police Department</td>
      <td>Police Officer</td>
      <td>$76,901.21</td>
      <td>$1,332.73</td>
      <td>$800.00</td>
      <td>$23,830.39</td>
      <td>NaN</td>
      <td>$36,616.00</td>
      <td>NaN</td>
      <td>$139,480.33</td>
      <td>2124</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Nous pouvons maintenant nous débarrasser des duplications, on utilisera pour cela :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boston_no_dup</span> <span class="o">=</span> <span class="n">boston</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">,</span><span class="s1">&#39;DEPARTMENT NAME&#39;</span><span class="p">,</span><span class="s1">&#39;TITLE&#39;</span><span class="p">],</span>
    <span class="n">keep</span><span class="o">=</span><span class="s2">&quot;first&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Dans ce cas, on garde le premier. On peut demander à garder le dernier (last) et
on utilisera des tris afin d’ordonner les résultats pour se débarrasser des duplications
non pertinentes.</p>
</section>
<section id="la-discretisation">
<h3>4.3.5 La discrétisation<a class="headerlink" href="#la-discretisation" title="Permalink to this heading">#</a></h3>
<p>La discrétisation permet de transformer une variable quantitative (l’âge des
individus par exemple) en une variable qualitative (une classe d’âge pour chaque individu). Pour cela, nous utilisons deux fonctions de Pandas : pd.cut() et
pd.qcut().</p>
<section id="intervalles-constants">
<h4>Intervalles constants<a class="headerlink" href="#intervalles-constants" title="Permalink to this heading">#</a></h4>
<p>Si nous désirons créer une variable de classe basée sur des intervalles de taille
constante allant du minimum au maximum.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;price_disc1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">],</span> 
                                <span class="n">bins</span><span class="o">=</span><span class="mi">5</span>
                               <span class="p">)</span>
<span class="n">listing</span><span class="p">[</span><span class="s2">&quot;price_disc1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>id
2577    (2.01, 1608.0]
3109    (2.01, 1608.0]
4886    (2.01, 1608.0]
4890    (2.01, 1608.0]
5396    (2.01, 1608.0]
Name: price_disc1, dtype: category
Categories (5, interval[float64]): [(2.01, 1608.0] &lt; (1608.0, 3206.0] &lt; (3206.0, 4804.0] &lt; (4804.0, 6402.0] &lt; (6402.0, 8000.0]]
</pre></div>
</div>
</div>
</div>
<p>On voit ici que la nouvelle variable a comme valeurs les intervalles.</p>
<p>Si vous voulez vérifier la répartition par intervalle, il suffit d’utiliser la méthode <em>.value_counts()</em> :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;price_disc1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2.01, 1608.0]      4995
(6402.0, 8000.0]       2
(1608.0, 3206.0]       2
(3206.0, 4804.0]       1
(4804.0, 6402.0]       0
Name: price_disc1, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Par ailleurs, si vous désirez donner des noms aux intervalles, vous pouvez le faire en utilisant le paramètre <em>labels=</em> de la fonction <em>cut()</em> :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;price_disc1&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">],</span> 
                              <span class="n">bins</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> 
                              <span class="n">labels</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                             <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="intervalles-definis-par-lutilisateur">
<h4>Intervalles définis par l’utilisateur<a class="headerlink" href="#intervalles-definis-par-lutilisateur" title="Permalink to this heading">#</a></h4>
<p>Si vous désirez créer des intervalles sur mesure, il vous suffit de donner les bornes
de ces intervalles. On utilise :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;price_disc2&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span>
    <span class="n">listing</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">],</span> 
    <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> 
          <span class="mi">50</span><span class="p">,</span>
          <span class="mi">100</span><span class="p">,</span>
          <span class="mi">500</span><span class="p">,</span>
          <span class="n">listing</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
         <span class="p">],</span>
    <span class="n">include_lowest</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">listing</span><span class="p">[</span><span class="s2">&quot;price_disc2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(50.0, 100.0]      2425
(100.0, 500.0]     1873
(9.999, 50.0]       646
(500.0, 8000.0]      56
Name: price_disc2, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>On remplace donc le nombre d’intervalles par une liste de valeurs (ici on prend le minimum et le maximum des données).</p>
<p>Afin d’inclure le minimum, on ajoute <em>include_lowest=True</em>.</p>
</section>
<section id="intervalles-de-frequence-constante">
<h4>Intervalles de fréquence constante<a class="headerlink" href="#intervalles-de-frequence-constante" title="Permalink to this heading">#</a></h4>
<p>Il est souvent intéressant de construire des intervalles ayant un nombre d’individus constant d’une classe à une autre.</p>
<p>Pour cela, on va utiliser une autre fonction de Pandas nommée <em>qcut()</em>. Elle prend le même type de paramètres que la
fonction précédente mais elle va créer des classes de taille similaire (en nombre d’individus) :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;price_disc3&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">],</span>
                               <span class="n">q</span><span class="o">=</span><span class="mi">5</span>
                              <span class="p">)</span>
<span class="n">listing</span><span class="p">[</span><span class="s2">&quot;price_disc3&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(9.999, 60.0]      1115
(60.0, 80.0]       1093
(100.0, 150.0]     1037
(150.0, 8000.0]     892
(80.0, 100.0]       863
Name: price_disc3, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Pandas a fait de son mieux pour bien distribuer les données dans les intervalles.
Comme il y a beaucoup de prix égaux, il n’a pas pu obtenir des intervalles avec des
fréquences parfaitement égales.</p>
</section>
</section>
<section id="les-tris">
<h3>4.3.6 Les tris<a class="headerlink" href="#les-tris" title="Permalink to this heading">#</a></h3>
<p>Les tris sont des outils importants en data science. Il vous arrive très fréquemment de vouloir trier des données. Chaque package possède des outils de tris, nous allons
en étudier deux : celui de NumPy et celui de Pandas.</p>
<section id="le-tri-de-numpy">
<h4>Le tri de NumPy<a class="headerlink" href="#le-tri-de-numpy" title="Permalink to this heading">#</a></h4>
<p>Si nous restons sur un array de NumPy dans son sens le plus classique, celui-ci contient une méthode .sort() qui s’applique très bien sur un array à une seule dimension, on pourra avoir :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">array1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">5000</span><span class="p">)</span>
<span class="n">array1</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Cette méthode modifie l’array1 et trie de manière croissante.</p>
<p>Si on désire faire un tri décroissant, on pourra utiliser :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">array1</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Comme vous le voyez, cette méthode n’est pas très efficace pour faire des tris
complexes. On utilisera une autre méthode nommée .argsort() :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">table</span><span class="p">[</span><span class="n">table</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[8.65705292e-01, 2.01722354e-04, 1.25991437e-02, ...,
        8.58252526e-02, 1.62550196e-01, 4.02018454e-01],
       [4.71036989e-01, 4.70354997e-04, 8.57725291e-02, ...,
        1.00433473e-01, 7.28004124e-01, 1.88864912e-01],
       [1.15708576e-03, 6.77614286e-04, 1.98632972e-01, ...,
        7.00591313e-01, 3.39485876e-01, 2.97035522e-01],
       ...,
       [7.45864355e-01, 9.99377543e-01, 6.20472689e-01, ...,
        7.52795300e-01, 5.28902266e-01, 8.05244124e-01],
       [2.55410418e-01, 9.99716541e-01, 7.46031462e-01, ...,
        1.48062718e-01, 2.73685193e-01, 8.99979098e-01],
       [6.78991428e-01, 9.99805524e-01, 1.21561651e-02, ...,
        3.31855151e-01, 1.37972051e-01, 5.69229573e-01]])
</pre></div>
</div>
</div>
</div>
<p>On trie donc sur la seconde colonne de notre array. On peut alors retourner le
résultat de ce tri.
Le tri basé sur .argsort() est extrêmement efficace mais s’applique avant tout
à un array.</p>
</section>
<section id="le-tri-de-pandas">
<h4>Le tri de Pandas<a class="headerlink" href="#le-tri-de-pandas" title="Permalink to this heading">#</a></h4>
<p>Pandas possède une fonction de tri sur les DataFrames extrêmement efficace qui se rapproche beaucoup d’une approche SQL des tris. Elle a de nombreux paramètres et permet de trier sur plusieurs clés dans des sens différents.</p>
<p>Si nous prenons nos données sur les logements AirBnB, nous désirons trier les données par ordre croissant de nombre de chambres, puis par niveau de prix décroissant.</p>
<p>Pour cela, une seule ligne de code est nécessaire :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># on affiche uniquement les 5 premières lignes du résultat</span>
<span class="n">listing</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;bedrooms&quot;</span><span class="p">,</span><span class="s2">&quot;price&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>listing_url</th>
      <th>scrape_id</th>
      <th>last_scraped</th>
      <th>name</th>
      <th>description</th>
      <th>neighborhood_overview</th>
      <th>picture_url</th>
      <th>host_id</th>
      <th>host_url</th>
      <th>host_name</th>
      <th>...</th>
      <th>calculated_host_listings_count</th>
      <th>calculated_host_listings_count_entire_homes</th>
      <th>calculated_host_listings_count_private_rooms</th>
      <th>calculated_host_listings_count_shared_rooms</th>
      <th>reviews_per_month</th>
      <th>instant_bookable_bool</th>
      <th>instant_bookable_bool2</th>
      <th>price_disc1</th>
      <th>price_disc2</th>
      <th>price_disc3</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>243040</th>
      <td>https://www.airbnb.com/rooms/243040</td>
      <td>20201012032825</td>
      <td>2020-10-21</td>
      <td>Apart Hotel / Paris Opera Madeleine</td>
      <td>&lt;b&gt;The space&lt;/b&gt;&lt;br /&gt;Home Suite Home @ paris ...</td>
      <td>NaN</td>
      <td>https://a0.muscache.com/pictures/2306504/b7a67...</td>
      <td>1275649</td>
      <td>https://www.airbnb.com/users/show/1275649</td>
      <td>Gwenael</td>
      <td>...</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0.52</td>
      <td>False</td>
      <td>False</td>
      <td>4</td>
      <td>(500.0, 8000.0]</td>
      <td>(150.0, 8000.0]</td>
    </tr>
    <tr>
      <th>245715</th>
      <td>https://www.airbnb.com/rooms/245715</td>
      <td>20201012032825</td>
      <td>2020-10-21</td>
      <td>Apart Hotel Paris Champs Elysee</td>
      <td>&lt;b&gt;The space&lt;/b&gt;&lt;br /&gt;@ Home Suite Home Paris ...</td>
      <td>NaN</td>
      <td>https://a0.muscache.com/pictures/23451178/47bc...</td>
      <td>1275649</td>
      <td>https://www.airbnb.com/users/show/1275649</td>
      <td>Gwenael</td>
      <td>...</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0.61</td>
      <td>False</td>
      <td>False</td>
      <td>4</td>
      <td>(500.0, 8000.0]</td>
      <td>(150.0, 8000.0]</td>
    </tr>
    <tr>
      <th>1826605</th>
      <td>https://www.airbnb.com/rooms/1826605</td>
      <td>20201012032825</td>
      <td>2020-10-17</td>
      <td>2 beds 40 m2 flat near Canal Saint Martin</td>
      <td>Bright apartment fitted kitchen close to all a...</td>
      <td>NaN</td>
      <td>https://a0.muscache.com/pictures/4198ce40-6fdd...</td>
      <td>9557903</td>
      <td>https://www.airbnb.com/users/show/9557903</td>
      <td>Thierry</td>
      <td>...</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1.24</td>
      <td>False</td>
      <td>False</td>
      <td>0</td>
      <td>(500.0, 8000.0]</td>
      <td>(150.0, 8000.0]</td>
    </tr>
    <tr>
      <th>1206047</th>
      <td>https://www.airbnb.com/rooms/1206047</td>
      <td>20201012032825</td>
      <td>2020-10-17</td>
      <td>Charming apartment in Paris 20</td>
      <td>&lt;b&gt;The space&lt;/b&gt;&lt;br /&gt;Charming apartment in Mé...</td>
      <td>NaN</td>
      <td>https://a0.muscache.com/pictures/18144015/ae0d...</td>
      <td>2255607</td>
      <td>https://www.airbnb.com/users/show/2255607</td>
      <td>Baptiste</td>
      <td>...</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>NaN</td>
      <td>False</td>
      <td>False</td>
      <td>0</td>
      <td>(500.0, 8000.0]</td>
      <td>(150.0, 8000.0]</td>
    </tr>
    <tr>
      <th>1248036</th>
      <td>https://www.airbnb.com/rooms/1248036</td>
      <td>20201012032825</td>
      <td>2020-10-18</td>
      <td>Appartement définitivement indisponible.</td>
      <td>Appartement définitivement indisponible et ann...</td>
      <td>Appartement définitivement indisponible et ann...</td>
      <td>https://a0.muscache.com/pictures/18803340/7edc...</td>
      <td>6800881</td>
      <td>https://www.airbnb.com/users/show/6800881</td>
      <td>Laure-Line</td>
      <td>...</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0.01</td>
      <td>False</td>
      <td>False</td>
      <td>0</td>
      <td>(500.0, 8000.0]</td>
      <td>(150.0, 8000.0]</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 78 columns</p>
</div></div></div>
</div>
<p>On a donc bien un outil puissant basé sur des listes de clés. Comme dans le cas des jointures avec Pandas, lorsqu’on a plusieurs variables ou paramètres de tri, on les place dans une liste.</p>
<p>Par défaut, le tri de Pandas trie par colonne avec le paramètre <em>axis=1</em>. Si vous désirez trier par ligne, vous pouvez changer ce paramètre.</p>
<p>Pandas vous permet aussi d’effectuer des tris sur les index en utilisant .sort_index().</p>
<p>L’outil de tri de Pandas est moins performant en termes de rapidité d’exécution que le <em>.argsort()</em> de NumPy. Néanmoins, les possibilités plus grandes et le fait de travailler sur une structure plus complexe, telle que le DataFrame, nous confortent
dans l’utilisation du tri de Pandas pour nos analyses.</p>
</section>
</section>
<section id="le-traitement-de-donnees-temporelles">
<h3>4.3.7 Le traitement de données temporelles<a class="headerlink" href="#le-traitement-de-donnees-temporelles" title="Permalink to this heading">#</a></h3>
<p>Python a de nombreux outils pour travailler sur des dates, notamment le package
datetime nativement présent dans Python.</p>
<section id="les-dates-avec-numpy">
<h4>Les dates avec NumPy<a class="headerlink" href="#les-dates-avec-numpy" title="Permalink to this heading">#</a></h4>
<p>Depuis peu, il est possible de travailler avec des dates à l’intérieur d’un array de NumPy (depuis NumPy 1.7). Ainsi la fonction np.datetime64 permet de créer des dates, et le type datetime est utilisable pour créer des arrays. On peut par exemple
utiliser <em>arange()</em> pour générer une suite de semaines de janvier 2017 à janvier 2018 :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="s2">&quot;2017-01-01&quot;</span><span class="p">,</span><span class="s2">&quot;2018-01-01&quot;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;datetime64[W]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;2016-12-29&#39;, &#39;2017-01-05&#39;, &#39;2017-01-12&#39;, &#39;2017-01-19&#39;,
       &#39;2017-01-26&#39;, &#39;2017-02-02&#39;, &#39;2017-02-09&#39;, &#39;2017-02-16&#39;,
       &#39;2017-02-23&#39;, &#39;2017-03-02&#39;, &#39;2017-03-09&#39;, &#39;2017-03-16&#39;,
       &#39;2017-03-23&#39;, &#39;2017-03-30&#39;, &#39;2017-04-06&#39;, &#39;2017-04-13&#39;,
       &#39;2017-04-20&#39;, &#39;2017-04-27&#39;, &#39;2017-05-04&#39;, &#39;2017-05-11&#39;,
       &#39;2017-05-18&#39;, &#39;2017-05-25&#39;, &#39;2017-06-01&#39;, &#39;2017-06-08&#39;,
       &#39;2017-06-15&#39;, &#39;2017-06-22&#39;, &#39;2017-06-29&#39;, &#39;2017-07-06&#39;,
       &#39;2017-07-13&#39;, &#39;2017-07-20&#39;, &#39;2017-07-27&#39;, &#39;2017-08-03&#39;,
       &#39;2017-08-10&#39;, &#39;2017-08-17&#39;, &#39;2017-08-24&#39;, &#39;2017-08-31&#39;,
       &#39;2017-09-07&#39;, &#39;2017-09-14&#39;, &#39;2017-09-21&#39;, &#39;2017-09-28&#39;,
       &#39;2017-10-05&#39;, &#39;2017-10-12&#39;, &#39;2017-10-19&#39;, &#39;2017-10-26&#39;,
       &#39;2017-11-02&#39;, &#39;2017-11-09&#39;, &#39;2017-11-16&#39;, &#39;2017-11-23&#39;,
       &#39;2017-11-30&#39;, &#39;2017-12-07&#39;, &#39;2017-12-14&#39;, &#39;2017-12-21&#39;],
      dtype=&#39;datetime64[W]&#39;)
</pre></div>
</div>
</div>
</div>
<p>Il existe de nombreuses fonctions permettant de travailler sur les dates, notamment avec les différences basées sur la fonction timedelta().
On peut aussi travailler sur les jours travaillés (business days). Cette partie de NumPy est en constante évolution. La documentation de NumPy est le meilleur outil pour en suivre les avancées.</p>
</section>
<section id="les-dates-avec-pandas">
<h4>Les dates avec Pandas<a class="headerlink" href="#les-dates-avec-pandas" title="Permalink to this heading">#</a></h4>
<p>C’est clairement Pandas qui a l’ascendant sur le traitement des dates en data science. Avec des fonctions efficaces et simples à prendre en main, le travail sur les dates est extrêmement simplifié.</p>
<p>Pandas possède de sérieux atouts dans la prise en compte des dates notamment avec l’intégration des formats de dates dans l’importation des données. Néanmoins, si vos données n’ont pas été correctement importées, il est très simple de transformer des chaînes de caractères dans un DataFrame ou dans une Series en dates. Pour cela, on utilise :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">([</span><span class="s1">&#39;11/12/2017&#39;</span><span class="p">,</span> <span class="s1">&#39;05-01-2018&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DatetimeIndex([&#39;2017-12-11&#39;, &#39;2018-01-05&#39;], dtype=&#39;datetime64[ns]&#39;, freq=None)
</pre></div>
</div>
</div>
</div>
<p>On crée ainsi un DatetimeIndex qui peut être utilisé dans une Series ou dans
un DataFrame. On peut aussi donner un format de dates en utilisant le paramètre <em>format=</em>.</p>
<p>Il est souvent intéressant de traiter de nombreuses dates. On a très souvent envie de générer des suites de dates de manière automatique. Imaginons que nous avons des données quotidiennes de cotation d’un indice boursier, et que nous désirons
transformer ces données en une série indexée sur les jours ouvrés pendant lesquels la banque est ouverte. Les données pour l’année sont stockées dans un array.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">index_ouverture</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">bdate_range</span><span class="p">(</span><span class="s1">&#39;2017-01-01&#39;</span><span class="p">,</span><span class="s1">&#39;2017-12-31&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">index_ouverture</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index_ouverture</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="_images/095069c0babe66a082a0e5a100af1a619abb4770dcef9cbc4d40ccfec6afe71a.png" src="_images/095069c0babe66a082a0e5a100af1a619abb4770dcef9cbc4d40ccfec6afe71a.png" />
</div>
</div>
<p>On peut aussi utiliser date_range() avec différents paramètres. Si par exemple,
on désire générer un index avec des relevés toutes les 2 heures entre le 1er février
2018 à 8h00 et le 31 mars 2018 à 8h00, on utilisera :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">index_temps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2018-02-01 08:00:00&#39;</span><span class="p">,</span><span class="s1">&#39;2018-03-31 08:00:00&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;2h&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">index_temps</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">index_temps</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(697,) datetime64[ns]
</pre></div>
</div>
</div>
</div>
<p>De nombreuses possibilités sont accessibles pour le traitement des dates et des heures.</p>
<p>Ainsi, si plutôt que des dates et des heures, vous préférez utiliser des périodes (ceci revient à utiliser un mois plutôt que le premier jour du mois comme valeur de votre index), vous pouvez le faire avec la fonction period_range().</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="s2">&quot;01-01-2017&quot;</span><span class="p">,</span><span class="s2">&quot;01-01-2018&quot;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;M&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PeriodIndex([&#39;2017-01&#39;, &#39;2017-02&#39;, &#39;2017-03&#39;, &#39;2017-04&#39;, &#39;2017-05&#39;, &#39;2017-06&#39;,
             &#39;2017-07&#39;, &#39;2017-08&#39;, &#39;2017-09&#39;, &#39;2017-10&#39;, &#39;2017-11&#39;, &#39;2017-12&#39;,
             &#39;2018-01&#39;],
            dtype=&#39;period[M]&#39;, freq=&#39;M&#39;)
</pre></div>
</div>
</div>
</div>
<p>On a ainsi généré une suite de mois. Ceci peut se faire sur des semaines (W), des trimestres (Q), des années (A)…</p>
<p>Si on désire générer des périodes, on pourra le faire grâce à pd.period() :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">period_range</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">&quot;2017-01&quot;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;M&quot;</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="s2">&quot;2019-01&quot;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;M&quot;</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;Q&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>PeriodIndex([&#39;2017Q1&#39;, &#39;2017Q2&#39;, &#39;2017Q3&#39;, &#39;2017Q4&#39;, &#39;2018Q1&#39;, &#39;2018Q2&#39;,
             &#39;2018Q3&#39;, &#39;2018Q4&#39;, &#39;2019Q1&#39;],
            dtype=&#39;period[Q-DEC]&#39;, freq=&#39;Q-DEC&#39;)
</pre></div>
</div>
</div>
</div>
<p>Par ailleurs, vous pouvez traiter les fuseaux horaires de manière simplifiée avec
Pandas en utilisant la propriété .tz. Par défaut, une date n’est associée à aucune
timezone :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">index_temps</span><span class="o">.</span><span class="n">tz</span> <span class="ow">is</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>Pour définir un fuseau horaire, on le fait généralement dans la fonction date_range(), qui a un paramètre tz = . Les fuseaux horaires peuvent être définis, avec
une chaîne de caractères incluant une combinaison zone/ville (“Europe/Paris”), vous pouvez en obtenir la liste exhaustive en important :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytz</span> <span class="kn">import</span> <span class="n">common_timezones</span><span class="p">,</span> <span class="n">all_timezones</span>
<span class="n">all_timezones</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Africa/Abidjan&#39;,
 &#39;Africa/Accra&#39;,
 &#39;Africa/Addis_Ababa&#39;,
 &#39;Africa/Algiers&#39;,
 &#39;Africa/Asmara&#39;,
 &#39;Africa/Asmera&#39;,
 &#39;Africa/Bamako&#39;,
 &#39;Africa/Bangui&#39;,
 &#39;Africa/Banjul&#39;,
 &#39;Africa/Bissau&#39;]
</pre></div>
</div>
</div>
</div>
<p>Si vous avez déjà défini vos dates et que vous désirez leur ajouter un fuseau horaire, vous allez utiliser la méthode tz_localize(). Imaginons que l’on génère
des données toutes les deux heures à Paris, on veut transformer cet index en passant sur le fuseau horaire de Nouméa en Nouvelle-Calédonie, voici le code :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">index_heures</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s2">&quot;2018-01-01 09:00:00&quot;</span><span class="p">,</span> <span class="s2">&quot;2018-01-01 18:00:00&quot;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;2h&quot;</span><span class="p">)</span>
<span class="n">index_heures_paris</span> <span class="o">=</span> <span class="n">index_heures</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s2">&quot;Europe/Paris&quot;</span><span class="p">)</span>
<span class="n">index_heures_paris</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DatetimeIndex([&#39;2018-01-01 09:00:00+01:00&#39;, &#39;2018-01-01 11:00:00+01:00&#39;,
               &#39;2018-01-01 13:00:00+01:00&#39;, &#39;2018-01-01 15:00:00+01:00&#39;,
               &#39;2018-01-01 17:00:00+01:00&#39;],
              dtype=&#39;datetime64[ns, Europe/Paris]&#39;, freq=None)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">index_heures_noumea</span> <span class="o">=</span> <span class="n">index_heures_paris</span><span class="o">.</span><span class="n">tz_convert</span><span class="p">(</span><span class="s2">&quot;Pacific/Noumea&quot;</span><span class="p">)</span>
<span class="n">index_heures_noumea</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DatetimeIndex([&#39;2018-01-01 19:00:00+11:00&#39;, &#39;2018-01-01 21:00:00+11:00&#39;,
               &#39;2018-01-01 23:00:00+11:00&#39;, &#39;2018-01-02 01:00:00+11:00&#39;,
               &#39;2018-01-02 03:00:00+11:00&#39;],
              dtype=&#39;datetime64[ns, Pacific/Noumea]&#39;, freq=None)
</pre></div>
</div>
</div>
</div>
<p>Il existe de nombreux autres outils pour travailler sur les dates en Python.
Notamment, lorsqu’on traite des séries temporelles, on peut utiliser l’outil rolling :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index_ouverture</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index_ouverture</span><span class="p">)</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="c1">#La deuxième ligne permet d’afficher la moyenne prise sur 10 points adjacents.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="_images/f2291cf0910757af23dffc8436972f8dd91840a60f96f995f58ed679e79d34af.png" src="_images/f2291cf0910757af23dffc8436972f8dd91840a60f96f995f58ed679e79d34af.png" />
</div>
</div>
</section>
</section>
<section id="le-traitement-des-donnees-manquantes">
<h3>4.3.8 Le traitement des données manquantes<a class="headerlink" href="#le-traitement-des-donnees-manquantes" title="Permalink to this heading">#</a></h3>
<p>Les données manquantes sont un domaine de la data science à part entière. Leur traitement nécessite une réflexion bien au-delà de quelques lignes de codes.</p>
<p>Dans tous vos projets data science, vous serez confronté à des données manquantes, elles sont réparties en trois types principaux :</p>
<ul class="simple">
<li><p>Les données manquantes complètement aléatoirement</p></li>
<li><p>Les données manquantes aléatoirement</p></li>
<li><p>Les données manquantes non aléatoirement</p></li>
</ul>
<p>Ainsi, pour les deux premiers cas, on pourra penser à des méthodes d’imputation
alors que pour le troisième il ne sera pas possible de faire cela.</p>
<section id="les-donnees-manquantes-en-python">
<h4>Les données manquantes en Python<a class="headerlink" href="#les-donnees-manquantes-en-python" title="Permalink to this heading">#</a></h4>
<p>NumPy possède un code standard pour gérer les données manquantes, il s’agit
de NaN. On peut définir un élément d’un array comme une donnée manquante en
utilisant :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">table</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">table</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>nan
</pre></div>
</div>
</div>
</div>
<p>L’avantage d’utiliser ce codage réside dans le fait que les nan n’altèrent pas le type
de votre array et qu’ils ne sont pas pris en compte dans les calculs de statistiques
descriptives avec les fonctions adaptées :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">vec</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9.0
</pre></div>
</div>
</div>
</div>
<p>Lorsque vous importez des données avec Pandas, celui-ci va automatiquement
remplacer les données manquantes par des codes nan.</p>
</section>
<section id="la-suppression-des-donnees-manquantes">
<h4>La suppression des données manquantes<a class="headerlink" href="#la-suppression-des-donnees-manquantes" title="Permalink to this heading">#</a></h4>
<p>L’approche la plus simple pour traiter des données manquantes est de supprimer les observations comportant des données manquantes.</p>
<p>Pandas comporte de nombreuses méthodes pour cela. Si nous prenons les données sur les salaires des employés de la ville de Boston, nous pouvons utiliser :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># la table globale</span>
<span class="n">boston</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(22245, 12)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># la table lorsqu’on retire les lignes avec données manquantes</span>
<span class="n">boston</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(123, 12)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># la table lorsqu’on retire les colonnes avec des données manquantes</span>
<span class="n">boston</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(22245, 4)
</pre></div>
</div>
</div>
</div>
<p>On voit que dans cette table de nombreuses données manquantes existent surtout sur huit colonnes. Quatre colonnes sont complètes.</p>
</section>
<section id="la-completion-par-la-moyenne-le-mode-ou-la-mediane">
<h4>La complétion par la moyenne, le mode ou la médiane<a class="headerlink" href="#la-completion-par-la-moyenne-le-mode-ou-la-mediane" title="Permalink to this heading">#</a></h4>
<p>Avant de compléter nos données, il va falloir transformer nos données Boston de manière à avoir des données numériques. En s’inspirant du code vu plus haut pour les données AirBnB, nous pouvons faire cela avec :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">boston</span><span class="o">.</span><span class="n">columns</span> <span class="p">:</span>
    <span class="k">if</span> <span class="n">boston</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span><span class="o">==</span><span class="nb">object</span> <span class="p">:</span>
        <span class="n">boston</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">boston</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\(.*\)&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>\
                                  <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">),</span>
                                  <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Dans ce code, on supprime d’abord les parenthèses en utilisant une expression régulière (voir le chapitre 2), puis on élimine les virgules et on enlève du sigle $ lorsqu’il est en début de chaîne.</p>
<p>On a maintenant huit colonnes en float avec des salaires.</p>
<p>On peut maintenant travailler sur les données manquantes. Il existe deux moyens de compléter par la moyenne ou par la médiane.</p>
<p>Un premier en utilisant Pandas :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># pour la moyenne</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">boston</span><span class="o">.</span><span class="n">columns</span> <span class="p">:</span>
    <span class="k">if</span> <span class="n">boston</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">number</span> <span class="p">:</span>
        <span class="n">boston</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">boston</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">boston</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

        
<span class="c1"># pour la médiane</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">boston</span><span class="o">.</span><span class="n">columns</span> <span class="p">:</span>
    <span class="k">if</span> <span class="n">boston</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span><span class="n">np</span><span class="o">.</span><span class="n">number</span> <span class="p">:</span>
        <span class="n">boston</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">boston</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">boston</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">())</span>

<span class="c1"># pour le mode, on utilise une condition à l’intérieur de l’appel de la boucle </span>
<span class="c1"># qui est équivalente à ce que nous faisions plus haut</span>
<span class="c1"># le calcul du mode renvoie un objet Series et non une valeur comme les autres </span>
<span class="c1"># méthodes, d’où le [0]</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">boston</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span> <span class="p">:</span>
    <span class="n">boston</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">boston</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">boston</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">mode</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-49-d744a53c596a&gt;:3: DeprecationWarning: Converting `np.inexact` or `np.floating` to a dtype is deprecated. The current result is `float64` which is not strictly correct.
  if boston[col].dtype ==np.number :
&lt;ipython-input-49-d744a53c596a&gt;:9: DeprecationWarning: Converting `np.inexact` or `np.floating` to a dtype is deprecated. The current result is `float64` which is not strictly correct.
  if boston[col].dtype ==np.number :
</pre></div>
</div>
</div>
</div>
<p>Le package Scikit-Learn permet aussi de faire des remplacements par la moyenne
ou la médiane :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># à partir de sklearn version 0.20</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="c1"># on crée un objet de cette classe avec la stratégie d’imputation comme</span>
<span class="c1"># paramètre</span>
<span class="n">imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="s2">&quot;mean&quot;</span><span class="p">)</span>
<span class="c1"># on construit un nouveau jeu de données en appliquant la méthode</span>
<span class="c1"># .fit_transform()</span>
<span class="n">boston_imputee2</span> <span class="o">=</span> <span class="n">imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">boston</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="le-traitement-des-colonnes-avec-des-donnees-qualitatives">
<h3>4.3.9 Le traitement des colonnes avec des données qualitatives<a class="headerlink" href="#le-traitement-des-colonnes-avec-des-donnees-qualitatives" title="Permalink to this heading">#</a></h3>
<p>Les données qualitatives sont extrêmement présentes dans les données. Dès que vous travaillez sur des données socio-démographiques sur des individus, vous allez rencontrer des données qualitatives. Le traitement des données qualitatives est souvent négligé dans les ouvrages de traitement de la donnée. Il est donc primordial de bien expliquer le traitement qu’elles requièrent.</p>
<section id="le-type-categorical">
<h4>Le type categorical<a class="headerlink" href="#le-type-categorical" title="Permalink to this heading">#</a></h4>
<p>Les données qualitatives sont des valeurs textuelles par défaut. Pandas propose un type spécifique pour traiter ce type de données. Le type categorical permet d’optimiser le traitement de ce type de données.</p>
<p>Il permet de créer et de transformer des données de ce type. Vous avez importé des données avec des variables qualitatives, Pandas va automatiquement les considérer comme du type object. Vous pourrez le voir en utilisant la propriété .dtype.
Si vous désirez transformer ce type en un type categorical, vous pouvez utiliser la fonction pd.Categorical() :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">var_quali</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">([</span><span class="s2">&quot;Boston&quot;</span><span class="p">,</span><span class="s2">&quot;Paris&quot;</span><span class="p">,</span><span class="s2">&quot;Londres&quot;</span><span class="p">,</span><span class="s2">&quot;Paris&quot;</span><span class="p">,</span> <span class="s2">&quot;Boston&quot;</span><span class="p">])</span>
<span class="n">var_quali</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Boston&#39;, &#39;Paris&#39;, &#39;Londres&#39;, &#39;Paris&#39;, &#39;Boston&#39;]
Categories (3, object): [&#39;Boston&#39;, &#39;Londres&#39;, &#39;Paris&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># on peut ajouter une modalité</span>
<span class="n">var_quali</span> <span class="o">=</span> <span class="n">var_quali</span><span class="o">.</span><span class="n">add_categories</span><span class="p">(</span><span class="s2">&quot;Rome&quot;</span><span class="p">)</span>
<span class="c1"># on alloue cette valeur à un élément de notre objet</span>
<span class="n">var_quali</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Rome&quot;</span> 
</pre></div>
</div>
</div>
</div>
<p>Si on modifie notre objet en y ajoutant une modalité non définie au préalable alors on aura un message d’erreur.
Si on veut transformer une colonne objet en category, on utilise :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boston</span><span class="p">[</span><span class="s2">&quot;POSTAL&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">boston</span><span class="p">[</span><span class="s2">&quot;POSTAL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
<span class="c1">#équivalent sans warning</span>
<span class="n">boston</span><span class="p">[</span><span class="s2">&quot;POSTAL&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">boston</span><span class="p">[</span><span class="s2">&quot;POSTAL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">types</span><span class="o">.</span><span class="n">CategoricalDtype</span><span class="p">(</span><span class="n">ordered</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

<span class="n">boston</span><span class="p">[</span><span class="s2">&quot;POSTAL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CategoricalDtype(categories=[&#39;10025&#39;, &#39;10033&#39;, &#39;10128&#39;, &#39;1027&#39;, &#39;1028&#39;, &#39;1040&#39;, &#39;10466&#39;,
                  &#39;10512&#39;, &#39;1057&#39;, &#39;1085&#39;,
                  ...
                  &#39;95008&#39;, &#39;97201&#39;, &#39;97209&#39;, &#39;97410&#39;, &#39;98074&#39;, &#39;98121&#39;,
                  &#39;98144&#39;, &#39;98296&#39;, &#39;B1S 3&#39;, &#39;UNKNO&#39;],
                 ordered=False)
</pre></div>
</div>
</div>
</div>
<p>On utilise ordered = False car il n’y a pas d’ordre entre les modalités de notre colonne. Si une notion d’ordre doit être ajoutée, on ajoute la liste des modalités et on
passe le paramètre ordered à True.</p>
<p>Le type Categorical est inspiré du type factor de R.</p>
</section>
<section id="la-transformation-des-donnees">
<h4>La transformation des données<a class="headerlink" href="#la-transformation-des-donnees" title="Permalink to this heading">#</a></h4>
<p>Pour traiter des données qualitatives, il faudra les transformer.</p>
<p>En effet, les algorithmes que vous aurez à utiliser sont basés sur des données numériques et donc des variables quantitatives.</p>
<p>Si vous travaillez sur des données nominales, il va falloir transformer les variables en indicatrices. C’est-à-dire que vous allez obtenir une colonne pour chaque modalité de votre variable qualitative.</p>
<p>Cette approche peut être appliquée avec deux packages que nous utilisons souvent : Pandas et Scikit-Learn.</p>
<p>Dans le cadre de nos données sur les logements AirBnB, nous avons plusieurs variables qualitatives, notamment roomtype qui a trois modalités :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;room_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Entire home/apt    4483
Private room        503
Shared room           9
Hotel room            5
Name: room_type, dtype: int64
</pre></div>
</div>
</div>
</div>
<section id="approche-pandas-avec-get-dummies">
<h5>Approche Pandas avec get_dummies() :<a class="headerlink" href="#approche-pandas-avec-get-dummies" title="Permalink to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">frame_room_type</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;room_type&quot;</span><span class="p">])</span>
<span class="n">frame_room_type</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Entire home/apt</th>
      <th>Hotel room</th>
      <th>Private room</th>
      <th>Shared room</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2577</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3109</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4886</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4890</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5396</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Cette fonction crée un nouveau DataFrame</p>
</section>
<section id="approche-scikit-learn-avec-onehotencoder">
<h5>Approche Scikit-Learn avec OneHotEncoder() :<a class="headerlink" href="#approche-scikit-learn-avec-onehotencoder" title="Permalink to this heading">#</a></h5>
<p>Dans ce cas, il faut que la variable qualitative soit déjà sous forme d’entiers entre 0 et p-1, p étant le nombre de modalités de notre variable.</p>
<p>On va combiner deux classes de Scikit-Learn : LabelEncoder et OneHotEncoder.</p>
<p>La première va permettre de recoder les valeurs textuelles en entiers et la seconde de construire des colonnes binaires à partir des valeurs de la variable transformée.</p>
<p>Voici le code :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># on importe les classes</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="c1"># on crée un objet de la classe LabelEncoder</span>
<span class="n">encode1</span><span class="o">=</span><span class="n">LabelEncoder</span><span class="p">()</span>
<span class="c1"># on crée un objet de la classe OneHotEncoder</span>
<span class="n">encode2</span><span class="o">=</span><span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="c1"># on combine l’application des deux classes</span>
<span class="n">array_out</span><span class="o">=</span><span class="n">encode2</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">encode1</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;room_type&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="c1"># on transforme la sortie en DataFrame</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">array_out</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;room_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Entire home/apt</th>
      <th>Private room</th>
      <th>Hotel room</th>
      <th>Shared room</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>Attention à partir de la version 0.20 de Scikit Learn, OneHotEncoder peut gérer des données non numériques, on a alors :</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># on importe les classes</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>
<span class="c1"># on crée un objet de la classe OneHotEncoder</span>
<span class="n">encode</span><span class="o">=</span><span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,)</span>
<span class="c1"># on l&#39;applique directement sur la colonnes initiale</span>
<span class="n">array_out</span><span class="o">=</span><span class="n">encode</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;room_type&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="c1"># on transforme la sortie en DataFrame</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">array_out</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;room_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Entire home/apt</th>
      <th>Private room</th>
      <th>Hotel room</th>
      <th>Shared room</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Si vous travaillez sur des données ordinales (avec des modalités ordonnées), il vous suffit de recoder une variable avec des valeurs chiffrées (attention, cette approche
n’est valable que pour des données ordinales).</p>
</section>
<section id="approche-avec-pandas">
<h5>Approche avec Pandas :<a class="headerlink" href="#approche-avec-pandas" title="Permalink to this heading">#</a></h5>
<p>Il n’y a pas d’approche automatisée, on peut utiliser le code suivant :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;room_type2&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;room_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;room_type&quot;</span><span class="p">]</span>\
                                                        <span class="o">.</span><span class="n">unique</span><span class="p">(),</span>
                                                        <span class="nb">range</span><span class="p">(</span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;room_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()))</span> <span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>On crée donc une colonne en utilisant un dictionnaire qui permet de faire correspondre
des éléments de celui-ci à des valeurs entières.</p>
</section>
<section id="approche-avec-scikit-learn">
<h5>Approche avec Scikit-Learn :<a class="headerlink" href="#approche-avec-scikit-learn" title="Permalink to this heading">#</a></h5>
<p>Cette approche est plus simple, elle se base sur l’outil LabelEncoder et se fait avec
ce code :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span>
<span class="n">encode1</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
<span class="n">listing</span><span class="p">[</span><span class="s2">&quot;room_type2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">encode1</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;room_type&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Ces méthodes sont centrales car la plupart des algorithmes en Python ne
supportent pas le type categorical.</p>
</section>
</section>
</section>
<section id="les-transformations-numeriques">
<h3>4.3.10 Les transformations numériques<a class="headerlink" href="#les-transformations-numeriques" title="Permalink to this heading">#</a></h3>
<p>Lorsque vous travaillez sur des données, un certain nombre de transformations de base sont nécessaires. Trois packages pourront être utiles pour ce type de transformations : Scikit-Learn, Pandas et SciPy.</p>
<p>Avec Pandas, la plupart des transformations se font en faisant les calculs directement en utilisant les fonctions universelles de Pandas.</p>
<p>Avec Scikit-Learn, l’approche est légèrement différente. Dans ce cas, on utilise des classes permettant de transformer les données.</p>
<p>SciPy nous permet d’appliquer des transformations plus spécifiques.</p>
<p>Nous utiliserons les données sur les employés de la ville de Boston desquelles nous extrayons les colonnes numériques :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boston_num</span><span class="o">=</span><span class="n">boston</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<section id="centrer-et-reduire-les-donnees">
<h4>Centrer et réduire les données<a class="headerlink" href="#centrer-et-reduire-les-donnees" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># avec Pandas pour centrer et réduire</span>
<span class="n">boston_std</span><span class="o">=</span><span class="n">boston_num</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">/</span><span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">())</span>
<span class="n">boston_std</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>REGULAR</th>
      <th>RETRO</th>
      <th>OTHER</th>
      <th>OVERTIME</th>
      <th>INJURED</th>
      <th>DETAIL</th>
      <th>QUINN/EDUCATION INCENTIVE</th>
      <th>TOTAL EARNINGS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.850181</td>
      <td>-3.658383e-16</td>
      <td>1.441325</td>
      <td>-0.745999</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>6.881953e+00</td>
      <td>2.036972</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.123227</td>
      <td>-3.658383e-16</td>
      <td>-0.041237</td>
      <td>-1.393149</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-3.070775e-15</td>
      <td>-0.184888</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.701400</td>
      <td>-3.658383e-16</td>
      <td>0.375293</td>
      <td>1.301949</td>
      <td>0.000000</td>
      <td>0.431839</td>
      <td>6.015775e+00</td>
      <td>2.614268</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.910494</td>
      <td>1.820365e+00</td>
      <td>1.426269</td>
      <td>6.827857</td>
      <td>-3.098121</td>
      <td>-0.413733</td>
      <td>3.238995e+00</td>
      <td>3.203649</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.232093</td>
      <td>-3.658383e-16</td>
      <td>-0.524861</td>
      <td>-0.764557</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-3.070775e-15</td>
      <td>0.131807</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># avec Scikit-Learn, on utilisera la classe StandardScaler :</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">(</span><span class="n">with_mean</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">with_std</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">rescaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">boston_num</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rescaled</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">boston_num</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">boston_num</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>REGULAR</th>
      <th>RETRO</th>
      <th>OTHER</th>
      <th>OVERTIME</th>
      <th>INJURED</th>
      <th>DETAIL</th>
      <th>QUINN/EDUCATION INCENTIVE</th>
      <th>TOTAL EARNINGS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.850223</td>
      <td>-3.658465e-16</td>
      <td>1.441358</td>
      <td>-0.746016</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>6.882107e+00</td>
      <td>2.037018</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.123229</td>
      <td>-3.658465e-16</td>
      <td>-0.041238</td>
      <td>-1.393180</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-3.070844e-15</td>
      <td>-0.184892</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.701439</td>
      <td>-3.658465e-16</td>
      <td>0.375301</td>
      <td>1.301979</td>
      <td>0.000000</td>
      <td>0.431848</td>
      <td>6.015910e+00</td>
      <td>2.614326</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.910515</td>
      <td>1.820406e+00</td>
      <td>1.426301</td>
      <td>6.828010</td>
      <td>-3.098191</td>
      <td>-0.413743</td>
      <td>3.239068e+00</td>
      <td>3.203721</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.232098</td>
      <td>-3.658465e-16</td>
      <td>-0.524873</td>
      <td>-0.764574</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>-3.070844e-15</td>
      <td>0.131810</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="changer-dechelle">
<h4>Changer d’échelle<a class="headerlink" href="#changer-dechelle" title="Permalink to this heading">#</a></h4>
<p>On utilise pour passer à une échelle 0-100 :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># avec Pandas</span>
<span class="n">boston_0_100</span> <span class="o">=</span> <span class="n">boston_num</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
<span class="n">boston_0_100</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>REGULAR</th>
      <th>RETRO</th>
      <th>OTHER</th>
      <th>OVERTIME</th>
      <th>INJURED</th>
      <th>DETAIL</th>
      <th>QUINN/EDUCATION INCENTIVE</th>
      <th>TOTAL EARNINGS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>48.942225</td>
      <td>9.489153</td>
      <td>7.311559</td>
      <td>5.625871</td>
      <td>7.765386</td>
      <td>14.726334</td>
      <td>63.678644</td>
      <td>47.964260</td>
    </tr>
    <tr>
      <th>1</th>
      <td>21.507463</td>
      <td>9.489153</td>
      <td>1.919201</td>
      <td>1.068627</td>
      <td>7.765386</td>
      <td>14.726334</td>
      <td>42.266215</td>
      <td>16.945978</td>
    </tr>
    <tr>
      <th>2</th>
      <td>46.873844</td>
      <td>9.489153</td>
      <td>3.434198</td>
      <td>20.047572</td>
      <td>7.765386</td>
      <td>17.086743</td>
      <td>60.983628</td>
      <td>56.023593</td>
    </tr>
    <tr>
      <th>3</th>
      <td>35.878487</td>
      <td>17.385912</td>
      <td>7.256796</td>
      <td>58.961144</td>
      <td>0.020329</td>
      <td>12.464888</td>
      <td>52.343987</td>
      <td>64.251647</td>
    </tr>
    <tr>
      <th>4</th>
      <td>26.447199</td>
      <td>9.489153</td>
      <td>0.160171</td>
      <td>5.495185</td>
      <td>7.765386</td>
      <td>14.726334</td>
      <td>42.266215</td>
      <td>21.367201</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># avec Scikit-Learn</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="n">minmaxscaler</span><span class="o">=</span><span class="n">MinMaxScaler</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
<span class="n">boston_0_100</span><span class="o">=</span><span class="n">minmaxscaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">boston_num</span><span class="p">)</span>
<span class="n">boston_0_100</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">boston_0_100</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">boston_num</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">boston_num</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">boston_0_100</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>REGULAR</th>
      <th>RETRO</th>
      <th>OTHER</th>
      <th>OVERTIME</th>
      <th>INJURED</th>
      <th>DETAIL</th>
      <th>QUINN/EDUCATION INCENTIVE</th>
      <th>TOTAL EARNINGS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>48.942225</td>
      <td>9.489153</td>
      <td>7.311559</td>
      <td>5.625871</td>
      <td>7.765386</td>
      <td>14.726334</td>
      <td>63.678644</td>
      <td>47.964260</td>
    </tr>
    <tr>
      <th>1</th>
      <td>21.507463</td>
      <td>9.489153</td>
      <td>1.919201</td>
      <td>1.068627</td>
      <td>7.765386</td>
      <td>14.726334</td>
      <td>42.266215</td>
      <td>16.945978</td>
    </tr>
    <tr>
      <th>2</th>
      <td>46.873844</td>
      <td>9.489153</td>
      <td>3.434198</td>
      <td>20.047572</td>
      <td>7.765386</td>
      <td>17.086743</td>
      <td>60.983628</td>
      <td>56.023593</td>
    </tr>
    <tr>
      <th>3</th>
      <td>35.878487</td>
      <td>17.385912</td>
      <td>7.256796</td>
      <td>58.961144</td>
      <td>0.020329</td>
      <td>12.464888</td>
      <td>52.343987</td>
      <td>64.251647</td>
    </tr>
    <tr>
      <th>4</th>
      <td>26.447199</td>
      <td>9.489153</td>
      <td>0.160171</td>
      <td>5.495185</td>
      <td>7.765386</td>
      <td>14.726334</td>
      <td>42.266215</td>
      <td>21.367201</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="transformation-de-box-cox">
<h4>Transformation de Box-Cox<a class="headerlink" href="#transformation-de-box-cox" title="Permalink to this heading">#</a></h4>
<p>Lorsque vous désirez obtenir des données suivant une loi normale, vous risquez d’avoir besoin d’une transformation qui permette de se rapprocher de cette loi.</p>
<p>La transformation de Box-Cox est une transformation qui peut gérer ce problème.</p>
<p>Elle ne s’applique qu’à des données positives. Celle-ci est disponible dans le package SciPy et s’utilise de la manière suivante :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="n">total_earning_trans</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">boxcox</span><span class="p">(</span>
    <span class="n">boston_num</span><span class="p">[</span><span class="s2">&quot;TOTAL EARNINGS&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="echantillonnage-des-donnees">
<h3>4.3.11 Echantillonnage des données<a class="headerlink" href="#echantillonnage-des-donnees" title="Permalink to this heading">#</a></h3>
<p>Nous allons présenter deux approches d’échantillonnage :</p>
<ul class="simple">
<li><p>l’échantillonnage aléatoire sans remise,</p></li>
<li><p>l’échantillonnage stratifié.</p></li>
</ul>
<p>Pandas propose une méthode d’échantillonnage simple à mettre en oeuvre, il s’agit de la méthode sample.
Si on désire échantillonner aléatoirement 1000 lignes de notre base Boston, on utilisera :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boston_aleat_1000</span> <span class="o">=</span> <span class="n">boston</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">boston_aleat_1000</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1000, 12)
</pre></div>
</div>
</div>
</div>
<p>On peut se servir du paramètre frac = si on désire obtenir un échantillon de la taille d’une fraction du jeu de données initial.</p>
<p>L’échantillonnage stratifié consiste à reproduire dans vos échantillons les mêmes répartitions de certaines variables que dans l’échantillon initial.</p>
<p>Il peut se faire avec Pandas ou avec Scikit-Learn. On utilisera dans ce cas le listing des logements disponibles à Paris.</p>
<p>Si nous voulons échantillonner 10 % des logements en conservant la répartition du type de chambre (room_type), on utilisera :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># répartition dans l’échantillon initial</span>
<span class="n">listing</span><span class="p">[</span><span class="s2">&quot;room_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Entire home/apt    0.8966
Private room       0.1006
Shared room        0.0018
Hotel room         0.0010
Name: room_type, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># échantillonnage stratifié</span>
<span class="n">listing_sample</span> <span class="o">=</span> <span class="n">listing</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;room_type&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">.1</span><span class="p">))</span>
<span class="c1"># repartition dans l’échantillon final</span>
<span class="n">listing_sample</span><span class="p">[</span><span class="s2">&quot;room_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Entire home/apt    0.897796
Private room       0.100200
Shared room        0.002004
Name: room_type, dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
<section id="la-construction-de-tableaux-croises">
<h3>4.3.12 La construction de tableaux croisés<a class="headerlink" href="#la-construction-de-tableaux-croises" title="Permalink to this heading">#</a></h3>
<p>Les tableaux croisés peuvent être très utiles pour visualiser des croisements de colonnes de variables qualitatives et les intégrer dans d’autres calculs.
Deux fonctions dans Pandas sont utiles : la méthode frame.pivot_table() et la fonction pd.crosstab().</p>
<p>La seule différence entre ces deux approches réside dans les données qui sont acceptées dans chaque fonction. Pour pivot_table, sachant que c’est une méthode
appliquée à un DataFrame, toutes les données doivent venir de ce DataFrame. La fonction crosstab est différente, elle peut prendre en entrée des données issues
de plusieurs DataFrame ou d’arrays.</p>
<p>Si nous reprenons nos données AirBnB et que nous désirons croiser deux colonnes,
nous allons utiliser :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span>
    <span class="n">listing</span><span class="p">[</span><span class="s1">&#39;instant_bookable&#39;</span><span class="p">],</span> 
    <span class="n">listing</span><span class="p">[</span><span class="s1">&#39;room_type&#39;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>room_type</th>
      <th>Entire home/apt</th>
      <th>Hotel room</th>
      <th>Private room</th>
      <th>Shared room</th>
    </tr>
    <tr>
      <th>instant_bookable</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>f</th>
      <td>3712</td>
      <td>0</td>
      <td>406</td>
      <td>6</td>
    </tr>
    <tr>
      <th>t</th>
      <td>771</td>
      <td>5</td>
      <td>97</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Par défaut, cet outil inclut des comptages dans le tableau. Mais si on désirait afficher la moyenne du prix des logements, on utiliserait :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">listing</span><span class="p">[</span><span class="s1">&#39;instant_bookable&#39;</span><span class="p">],</span> 
            <span class="n">listing</span><span class="p">[</span><span class="s1">&#39;room_type&#39;</span><span class="p">],</span>
            <span class="n">values</span><span class="o">=</span><span class="n">listing</span><span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">],</span>
            <span class="n">aggfunc</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>room_type</th>
      <th>Entire home/apt</th>
      <th>Hotel room</th>
      <th>Private room</th>
      <th>Shared room</th>
    </tr>
    <tr>
      <th>instant_bookable</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>f</th>
      <td>127.322651</td>
      <td>NaN</td>
      <td>61.674877</td>
      <td>73.166667</td>
    </tr>
    <tr>
      <th>t</th>
      <td>124.886770</td>
      <td>217.0</td>
      <td>67.597938</td>
      <td>41.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">listing</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> 
                    <span class="n">index</span><span class="o">=</span><span class="s1">&#39;instant_bookable&#39;</span><span class="p">,</span> 
                    <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;room_type&#39;</span><span class="p">,</span>
                    <span class="n">aggfunc</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>room_type</th>
      <th>Entire home/apt</th>
      <th>Hotel room</th>
      <th>Private room</th>
      <th>Shared room</th>
    </tr>
    <tr>
      <th>instant_bookable</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>f</th>
      <td>127.322651</td>
      <td>NaN</td>
      <td>61.674877</td>
      <td>73.166667</td>
    </tr>
    <tr>
      <th>t</th>
      <td>124.886770</td>
      <td>217.0</td>
      <td>67.597938</td>
      <td>41.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>On peut aller plus loin en combinant plusieurs variables et en combinant plusieurs statistiques dans le tableau :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">listing</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="s1">&#39;price&#39;</span><span class="p">,</span>
                    <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;host_is_superhost&#39;</span><span class="p">,</span><span class="s1">&#39;instant_bookable&#39;</span><span class="p">],</span>
                    <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;room_type&#39;</span><span class="p">,</span> 
                    <span class="n">aggfunc</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="s1">&#39;count&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th colspan="4" halign="left">mean</th>
      <th colspan="4" halign="left">count</th>
    </tr>
    <tr>
      <th></th>
      <th>room_type</th>
      <th>Entire home/apt</th>
      <th>Hotel room</th>
      <th>Private room</th>
      <th>Shared room</th>
      <th>Entire home/apt</th>
      <th>Hotel room</th>
      <th>Private room</th>
      <th>Shared room</th>
    </tr>
    <tr>
      <th>host_is_superhost</th>
      <th>instant_bookable</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">f</th>
      <th>f</th>
      <td>124.529297</td>
      <td>NaN</td>
      <td>60.272727</td>
      <td>51.0</td>
      <td>3116.0</td>
      <td>NaN</td>
      <td>308.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>t</th>
      <td>115.585641</td>
      <td>161.666667</td>
      <td>65.680000</td>
      <td>40.0</td>
      <td>562.0</td>
      <td>3.0</td>
      <td>75.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">t</th>
      <th>f</th>
      <td>141.926829</td>
      <td>NaN</td>
      <td>66.081633</td>
      <td>117.5</td>
      <td>596.0</td>
      <td>NaN</td>
      <td>98.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>t</th>
      <td>149.897464</td>
      <td>300.000000</td>
      <td>74.136364</td>
      <td>41.5</td>
      <td>209.0</td>
      <td>2.0</td>
      <td>22.0</td>
      <td>2.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="extraire-des-statistiques-descriptives">
<h2>4.4 Extraire des statistiques descriptives<a class="headerlink" href="#extraire-des-statistiques-descriptives" title="Permalink to this heading">#</a></h2>
<section id="statistiques-pour-donnees-quantitatives">
<h3>4.4.1 Statistiques pour données quantitatives<a class="headerlink" href="#statistiques-pour-donnees-quantitatives" title="Permalink to this heading">#</a></h3>
<p>Lorsqu’on calcule des statistiques descriptives spécifiques aux données quantitatives sur un DataFrame complet, Pandas n’affiche des résultats que pour les variables quantitatives (sans message d’erreur pour les colonnes non quantitatives).</p>
<p>Statistiques descriptives de base
Quelques méthodes statistiques universelles de Pandas :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># moyenne</span>
<span class="n">boston</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>REGULAR                      61455.764284
RETRO                         2722.555034
OTHER                         3875.576450
OVERTIME                     15761.125615
INJURED                      22166.982634
DETAIL                       19292.675939
QUINN/EDUCATION INCENTIVE    16133.739261
TOTAL EARNINGS               71517.447431
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># variance</span>
<span class="n">boston</span><span class="o">.</span><span class="n">var</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>REGULAR                      1.353779e+09
RETRO                        1.545119e+06
OTHER                        4.640917e+07
OVERTIME                     1.040817e+08
INJURED                      5.092599e+07
DETAIL                       5.127755e+07
QUINN/EDUCATION INCENTIVE    1.403539e+06
TOTAL EARNINGS               2.614014e+09
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># écart-type</span>
<span class="n">boston</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>REGULAR                      36793.733234
RETRO                         1243.028295
OTHER                         6812.427267
OVERTIME                     10202.043674
INJURED                       7136.245092
DETAIL                        7160.834192
QUINN/EDUCATION INCENTIVE     1184.710373
TOTAL EARNINGS               51127.428966
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># médiane</span>
<span class="n">boston</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>REGULAR                      61455.764284
RETRO                         2722.555034
OTHER                         3875.576450
OVERTIME                     15761.125615
INJURED                      22166.982634
DETAIL                       19292.675939
QUINN/EDUCATION INCENTIVE    16133.739261
TOTAL EARNINGS               66218.240000
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># matrice de corrélation</span>
<span class="n">boston</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>REGULAR</th>
      <th>RETRO</th>
      <th>OTHER</th>
      <th>OVERTIME</th>
      <th>INJURED</th>
      <th>DETAIL</th>
      <th>QUINN/EDUCATION INCENTIVE</th>
      <th>TOTAL EARNINGS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>REGULAR</th>
      <td>1.000000</td>
      <td>0.151931</td>
      <td>-0.003753</td>
      <td>0.213226</td>
      <td>-0.088766</td>
      <td>0.013835</td>
      <td>0.109378</td>
      <td>0.868466</td>
    </tr>
    <tr>
      <th>RETRO</th>
      <td>0.151931</td>
      <td>1.000000</td>
      <td>0.053184</td>
      <td>0.401342</td>
      <td>-0.033370</td>
      <td>0.039013</td>
      <td>0.016559</td>
      <td>0.293904</td>
    </tr>
    <tr>
      <th>OTHER</th>
      <td>-0.003753</td>
      <td>0.053184</td>
      <td>1.000000</td>
      <td>0.097863</td>
      <td>0.070013</td>
      <td>0.024574</td>
      <td>0.016010</td>
      <td>0.126975</td>
    </tr>
    <tr>
      <th>OVERTIME</th>
      <td>0.213226</td>
      <td>0.401342</td>
      <td>0.097863</td>
      <td>1.000000</td>
      <td>-0.043067</td>
      <td>0.080187</td>
      <td>0.159767</td>
      <td>0.454531</td>
    </tr>
    <tr>
      <th>INJURED</th>
      <td>-0.088766</td>
      <td>-0.033370</td>
      <td>0.070013</td>
      <td>-0.043067</td>
      <td>1.000000</td>
      <td>-0.006834</td>
      <td>0.019239</td>
      <td>0.007562</td>
    </tr>
    <tr>
      <th>DETAIL</th>
      <td>0.013835</td>
      <td>0.039013</td>
      <td>0.024574</td>
      <td>0.080187</td>
      <td>-0.006834</td>
      <td>1.000000</td>
      <td>0.038830</td>
      <td>0.178945</td>
    </tr>
    <tr>
      <th>QUINN/EDUCATION INCENTIVE</th>
      <td>0.109378</td>
      <td>0.016559</td>
      <td>0.016010</td>
      <td>0.159767</td>
      <td>0.019239</td>
      <td>0.038830</td>
      <td>1.000000</td>
      <td>0.137591</td>
    </tr>
    <tr>
      <th>TOTAL EARNINGS</th>
      <td>0.868466</td>
      <td>0.293904</td>
      <td>0.126975</td>
      <td>0.454531</td>
      <td>0.007562</td>
      <td>0.178945</td>
      <td>0.137591</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Une autre fonction intéressante est la méthode .describe() qui affiche un certain nombre de statistiques pour les variables quantitatives (elle ne fait que cela par défaut mais nous verrons plus loin qu’elle peut s’appliquer aux variables qualitatives).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boston</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>REGULAR</th>
      <th>RETRO</th>
      <th>OTHER</th>
      <th>OVERTIME</th>
      <th>INJURED</th>
      <th>DETAIL</th>
      <th>QUINN/EDUCATION INCENTIVE</th>
      <th>TOTAL EARNINGS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>22245.000000</td>
      <td>22245.000000</td>
      <td>22245.000000</td>
      <td>22245.000000</td>
      <td>22245.000000</td>
      <td>22245.000000</td>
      <td>22245.000000</td>
      <td>22245.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>61455.764284</td>
      <td>2722.555034</td>
      <td>3875.576450</td>
      <td>15761.125615</td>
      <td>22166.982634</td>
      <td>19292.675939</td>
      <td>16133.739261</td>
      <td>71517.447431</td>
    </tr>
    <tr>
      <th>std</th>
      <td>36793.733234</td>
      <td>1243.028295</td>
      <td>6812.427267</td>
      <td>10202.043674</td>
      <td>7136.245092</td>
      <td>7160.834192</td>
      <td>1184.710373</td>
      <td>51127.428966</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>3.500000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>40.210000</td>
      <td>3.500000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>30823.270000</td>
      <td>2722.555034</td>
      <td>850.000000</td>
      <td>15761.125615</td>
      <td>22166.982634</td>
      <td>19292.675939</td>
      <td>16133.739261</td>
      <td>30160.550000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>61455.764284</td>
      <td>2722.555034</td>
      <td>3875.576450</td>
      <td>15761.125615</td>
      <td>22166.982634</td>
      <td>19292.675939</td>
      <td>16133.739261</td>
      <td>66218.240000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>92969.550000</td>
      <td>2722.555034</td>
      <td>3875.576450</td>
      <td>15761.125615</td>
      <td>22166.982634</td>
      <td>19292.675939</td>
      <td>16133.739261</td>
      <td>102602.380000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>264660.690000</td>
      <td>28657.850000</td>
      <td>187299.320000</td>
      <td>144873.750000</td>
      <td>285458.880000</td>
      <td>131008.000000</td>
      <td>38116.790000</td>
      <td>366232.650000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Si vous voulez construire votre propre DataFrame de statistiques, vous pouvez utiliser la méthode .agg(). Par exemple :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boston</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span><span class="s2">&quot;std&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>REGULAR</th>
      <th>RETRO</th>
      <th>OTHER</th>
      <th>OVERTIME</th>
      <th>INJURED</th>
      <th>DETAIL</th>
      <th>QUINN/EDUCATION INCENTIVE</th>
      <th>TOTAL EARNINGS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mean</th>
      <td>61455.764284</td>
      <td>2722.555034</td>
      <td>3875.576450</td>
      <td>15761.125615</td>
      <td>22166.982634</td>
      <td>19292.675939</td>
      <td>16133.739261</td>
      <td>71517.447431</td>
    </tr>
    <tr>
      <th>std</th>
      <td>36793.733234</td>
      <td>1243.028295</td>
      <td>6812.427267</td>
      <td>10202.043674</td>
      <td>7136.245092</td>
      <td>7160.834192</td>
      <td>1184.710373</td>
      <td>51127.428966</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<section id="des-statistiques-plus-avancees">
<h4>Des statistiques plus avancées<a class="headerlink" href="#des-statistiques-plus-avancees" title="Permalink to this heading">#</a></h4>
<p>Il peut arriver que des statistiques plus avancées soient nécessaires, notamment en se basant sur des distributions de probabilités. Pour cela, on utilisera plutôt le
package SciPy et plus précisément scipy.stats qui possède de nombreuses statistiques importantes.</p>
<p>Par exemple, on peut calculer l’asymétrie d’une distribution (skewness) en utilisant :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">skew</span>
<span class="n">skew</span><span class="p">(</span><span class="n">listing</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>26.429001118525413
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="statistiques-pour-donnees-qualitatives">
<h3>4.4.2 Statistiques pour données qualitatives<a class="headerlink" href="#statistiques-pour-donnees-qualitatives" title="Permalink to this heading">#</a></h3>
<p>Les statistiques descriptives pour des variables qualitatives sont très différentes de celles pour des variables quantitatives. Ainsi, on s’intéresse généralement au mode et à la fréquence des modalités de la variable, Pour cela, on pourra obtenir des statistiques simples en utilisant la méthode <em>.describe(include = “all”)</em>.</p>
<p>D’autres approches sont possibles mais elles s’appliqueront variables par variables sur un objet Series. Ainsi, on peut utiliser :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># nombre de modalités</span>
<span class="n">listing</span><span class="p">[</span><span class="s2">&quot;room_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># liste des modalités</span>
<span class="n">listing</span><span class="p">[</span><span class="s2">&quot;room_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;Entire home/apt&#39;, &#39;Private room&#39;, &#39;Hotel room&#39;, &#39;Shared room&#39;],
      dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># liste et fréquence d’apparition des modalités</span>
<span class="n">listing</span><span class="p">[</span><span class="s2">&quot;room_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Entire home/apt    4483
Private room        503
Shared room           9
Hotel room            5
Name: room_type, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calcul du mode</span>
<span class="n">listing</span><span class="p">[</span><span class="s2">&quot;room_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mode</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    Entire home/apt
dtype: object
</pre></div>
</div>
</div>
</div>
<p>Ces méthodes vont compter le nombre de modalité, afficher toutes les modalités, afficher les modalités ordonnées par fréquence d’apparition avec la fréquence associée,et enfin afficher le mode (la modalité avec la fréquence la plus élevée).</p>
<p>La méthode .value_counts() possède un certain nombre de paramètres pour inclure les données manquantes, normaliser les résultats…</p>
</section>
</section>
<section id="utilisation-du-groupby-pour-decrire-des-donnees">
<h2>4.5 Utilisation du groupby pour décrire des données<a class="headerlink" href="#utilisation-du-groupby-pour-decrire-des-donnees" title="Permalink to this heading">#</a></h2>
<section id="le-principe">
<h3>4.5.1 Le principe<a class="headerlink" href="#le-principe" title="Permalink to this heading">#</a></h3>
<p>La méthode .groupby est une méthode qui permet de construire un objet à partir d’un DataFrame. Cet objet sépare les données en fonction des modalités d’une ou de plusieurs variables qualitatives. On obtiendra ainsi de manière quasi-immédiate des
indicateurs par modalités.</p>
<p>De nombreuses méthodes sont disponibles sur ces objets groupby afin de maximiser la simplicité de manipulation de données.
Généralement, on suppose que le groupby est basé sur trois étapes : séparation/application et combinaison.</p>
<p>Par exemple, sur les données AirBnB, on peut faire cela par type de chambres :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">listing_group_room</span> <span class="o">=</span> <span class="n">listing</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;room_type&quot;</span><span class="p">)</span>
<span class="n">listing_group_room</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>room_type
Entire home/apt    126.903721
Hotel room         217.000000
Private room        62.817097
Shared room         62.444444
Name: price, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>On sépare et on calcule la moyenne, et on rassemble les résultats dans un nouvel objet. On affiche donc dans un objet Series les prix moyens par type de chambre. On voit ici qu’on a utilisé la méthode .mean() de la classe des objets groupby.</p>
</section>
<section id="les-operations-sur-les-objets-groupby">
<h3>4.5.2 Les opérations sur les objets groupby<a class="headerlink" href="#les-operations-sur-les-objets-groupby" title="Permalink to this heading">#</a></h3>
<p>On peut très simplement obtenir des statistiques plus poussées avec des groupby.</p>
<p>De nombreuses méthodes de transformation de données pourront être appliquées avec une étape .groupby().</p>
</section>
<section id="apply-une-methode-importante-pour-manipuler-vos-groupby">
<h3>4.5.3 Apply : une méthode importante pour manipuler vos groupby<a class="headerlink" href="#apply-une-methode-importante-pour-manipuler-vos-groupby" title="Permalink to this heading">#</a></h3>
<p>La méthode apply permet d’appliquer n’importe quelle fonction sur vos données.</p>
<p>Si par exemple, vous désirez calculer l’écart salarial au sein de chaque département sur les données des salariés de la ville de Boston, vous allez devoir utiliser la différence entre le maximum et le minimum. Il n’existe pas de fonction universelle.</p>
<p>Nous allons donc utiliser un groupby et la méthode apply :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diff_salaires_dep</span> <span class="o">=</span> <span class="n">boston</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;DEPARTMENT NAME&#39;</span><span class="p">)[</span><span class="s1">&#39;TOTAL EARNINGS&#39;</span><span class="p">]</span>\
                        <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">diff_salaires_dep</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DEPARTMENT NAME
Boston Police Department    366229.15
BPS Business Service        284561.66
Boston Fire Department      276546.71
Superintendent              243562.93
Kilmer K-8                  228972.45
Name: TOTAL EARNINGS, dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
<section id="cas-concret-dutilisation-dun-groupby">
<h3>4.5.4 Cas concret d’utilisation d’un groupby<a class="headerlink" href="#cas-concret-dutilisation-dun-groupby" title="Permalink to this heading">#</a></h3>
<p>Nous travaillons sur les données AirBnB. Nous désirons obtenir des statistiques descriptives sur les prix et leurs variations au sein de chaque arrondissement de Paris. Pour cela nous allons utiliser un groupby :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">listing</span><span class="o">.</span><span class="n">neighbourhood_cleansed</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>20
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># on construit des statistiques par quartier</span>
<span class="n">listing</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;neighbourhood_cleansed&quot;</span><span class="p">)[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span><span class="s2">&quot;std&quot;</span><span class="p">,</span><span class="s2">&quot;count&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span>
                                        <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>std</th>
      <th>count</th>
    </tr>
    <tr>
      <th>neighbourhood_cleansed</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Élysée</th>
      <td>258.602273</td>
      <td>851.591715</td>
      <td>88</td>
    </tr>
    <tr>
      <th>Passy</th>
      <td>218.935543</td>
      <td>570.924329</td>
      <td>184</td>
    </tr>
    <tr>
      <th>Palais-Bourbon</th>
      <td>166.547826</td>
      <td>133.839189</td>
      <td>115</td>
    </tr>
    <tr>
      <th>Luxembourg</th>
      <td>157.780488</td>
      <td>124.345829</td>
      <td>164</td>
    </tr>
    <tr>
      <th>Louvre</th>
      <td>151.355455</td>
      <td>93.740023</td>
      <td>110</td>
    </tr>
    <tr>
      <th>Hôtel-de-Ville</th>
      <td>150.337316</td>
      <td>113.021487</td>
      <td>231</td>
    </tr>
    <tr>
      <th>Temple</th>
      <td>142.846806</td>
      <td>89.976605</td>
      <td>288</td>
    </tr>
    <tr>
      <th>Panthéon</th>
      <td>135.223146</td>
      <td>117.455414</td>
      <td>178</td>
    </tr>
    <tr>
      <th>Bourse</th>
      <td>126.175141</td>
      <td>110.330845</td>
      <td>177</td>
    </tr>
    <tr>
      <th>Opéra</th>
      <td>120.696085</td>
      <td>75.017836</td>
      <td>212</td>
    </tr>
    <tr>
      <th>Batignolles-Monceau</th>
      <td>113.459871</td>
      <td>84.431921</td>
      <td>233</td>
    </tr>
    <tr>
      <th>Observatoire</th>
      <td>111.594948</td>
      <td>106.899365</td>
      <td>192</td>
    </tr>
    <tr>
      <th>Vaugirard</th>
      <td>109.212754</td>
      <td>79.997332</td>
      <td>276</td>
    </tr>
    <tr>
      <th>Reuilly</th>
      <td>107.957933</td>
      <td>101.725775</td>
      <td>179</td>
    </tr>
    <tr>
      <th>Popincourt</th>
      <td>107.071606</td>
      <td>152.286470</td>
      <td>579</td>
    </tr>
    <tr>
      <th>Entrepôt</th>
      <td>106.164481</td>
      <td>77.030045</td>
      <td>424</td>
    </tr>
    <tr>
      <th>Buttes-Montmartre</th>
      <td>94.249118</td>
      <td>85.384755</td>
      <td>601</td>
    </tr>
    <tr>
      <th>Gobelins</th>
      <td>92.559554</td>
      <td>54.730659</td>
      <td>157</td>
    </tr>
    <tr>
      <th>Buttes-Chaumont</th>
      <td>91.926890</td>
      <td>115.389358</td>
      <td>299</td>
    </tr>
    <tr>
      <th>Ménilmontant</th>
      <td>84.909169</td>
      <td>78.296367</td>
      <td>313</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Si nous désirons étudier les variations par arrondissement et par type d’appartement, nous pourrons avoir deux clés pour notre groupby :</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">listing</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;neighbourhood_cleansed&quot;</span><span class="p">,</span><span class="s2">&quot;room_type&quot;</span><span class="p">])[</span><span class="s2">&quot;price&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>neighbourhood_cleansed  room_type      
Batignolles-Monceau     Entire home/apt    118.807311
                        Private room        59.476190
Bourse                  Entire home/apt    132.477987
                        Private room        70.500000
Buttes-Chaumont         Entire home/apt     98.777020
                        Private room        52.744186
                        Shared room         30.000000
Buttes-Montmartre       Entire home/apt     98.539635
                        Private room        49.886792
Entrepôt                Entire home/apt    111.014909
                        Private room        58.282051
Gobelins                Entire home/apt     99.413415
                        Hotel room          99.000000
                        Private room        66.818182
Hôtel-de-Ville          Entire home/apt    156.541682
                        Private room        68.928571
                        Shared room         87.666667
Louvre                  Entire home/apt    156.942157
                        Private room        79.428571
                        Shared room         85.000000
Luxembourg              Entire home/apt    165.473333
                        Private room        75.357143
Ménilmontant            Entire home/apt     91.515358
                        Private room        48.437500
Observatoire            Entire home/apt    117.989527
                        Private room        64.608696
Opéra                   Entire home/apt    125.479424
                        Private room        78.400000
                        Shared room         53.000000
Palais-Bourbon          Entire home/apt    166.810811
                        Hotel room         490.000000
                        Private room        49.000000
Panthéon                Entire home/apt    141.941635
                        Hotel room         193.000000
                        Private room        65.588235
Passy                   Entire home/apt    238.208428
                        Hotel room         110.000000
                        Private room        95.791667
Popincourt              Entire home/apt    111.303664
                        Private room        56.000000
                        Shared room         39.000000
Reuilly                 Entire home/apt    114.396581
                        Private room        66.375000
Temple                  Entire home/apt    146.761465
                        Private room        71.600000
Vaugirard               Entire home/apt    116.057890
                        Private room        68.783784
                        Shared room         46.000000
Élysée                  Entire home/apt    274.123457
                        Private room        79.000000
Name: price, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>De nombreuses autres applications sont disponibles avec le groupby.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="04_01_recuperation_des_donnees.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Chapitre 4 - La préparation des données et les premières statistiques (1ère partie)</p>
      </div>
    </a>
    <a class="right-next"
       href="05_01_Data_visualisation_matplotlib_seaborn.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Chapitre 5 - La data visualisation avec Python (1ère partie)</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decrire-et-transformer-des-colonnes">4.3 Décrire et transformer des colonnes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#d-ecrire-la-structure-de-vos-donnees">4.3.1 D écrire la structure de vos données</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#quelles-transformations-pour-les-colonnes-de-vos-donnees">4.3.2 Quelles transformations pour les colonnes de vos données ?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#les-changements-de-types">4.3.3 Les changements de types</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#les-jointures-et-concatenations">4.3.4 Les jointures et concaténations</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#les-jointures-entre-dataframe">Les jointures entre DataFrame</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#la-gestion-des-duplications-de-lignes">4.3.4 La gestion des duplications de lignes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#la-discretisation">4.3.5 La discrétisation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#intervalles-constants">Intervalles constants</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#intervalles-definis-par-lutilisateur">Intervalles définis par l’utilisateur</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#intervalles-de-frequence-constante">Intervalles de fréquence constante</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#les-tris">4.3.6 Les tris</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#le-tri-de-numpy">Le tri de NumPy</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#le-tri-de-pandas">Le tri de Pandas</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#le-traitement-de-donnees-temporelles">4.3.7 Le traitement de données temporelles</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#les-dates-avec-numpy">Les dates avec NumPy</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#les-dates-avec-pandas">Les dates avec Pandas</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#le-traitement-des-donnees-manquantes">4.3.8 Le traitement des données manquantes</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#les-donnees-manquantes-en-python">Les données manquantes en Python</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#la-suppression-des-donnees-manquantes">La suppression des données manquantes</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#la-completion-par-la-moyenne-le-mode-ou-la-mediane">La complétion par la moyenne, le mode ou la médiane</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#le-traitement-des-colonnes-avec-des-donnees-qualitatives">4.3.9 Le traitement des colonnes avec des données qualitatives</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#le-type-categorical">Le type categorical</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#la-transformation-des-donnees">La transformation des données</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#approche-pandas-avec-get-dummies">Approche Pandas avec get_dummies() :</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#approche-scikit-learn-avec-onehotencoder">Approche Scikit-Learn avec OneHotEncoder() :</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#approche-avec-pandas">Approche avec Pandas :</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#approche-avec-scikit-learn">Approche avec Scikit-Learn :</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#les-transformations-numeriques">4.3.10 Les transformations numériques</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#centrer-et-reduire-les-donnees">Centrer et réduire les données</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#changer-dechelle">Changer d’échelle</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#transformation-de-box-cox">Transformation de Box-Cox</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#echantillonnage-des-donnees">4.3.11 Echantillonnage des données</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#la-construction-de-tableaux-croises">4.3.12 La construction de tableaux croisés</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extraire-des-statistiques-descriptives">4.4 Extraire des statistiques descriptives</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#statistiques-pour-donnees-quantitatives">4.4.1 Statistiques pour données quantitatives</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#des-statistiques-plus-avancees">Des statistiques plus avancées</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#statistiques-pour-donnees-qualitatives">4.4.2 Statistiques pour données qualitatives</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#utilisation-du-groupby-pour-decrire-des-donnees">4.5 Utilisation du groupby pour décrire des données</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#le-principe">4.5.1 Le principe</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#les-operations-sur-les-objets-groupby">4.5.2 Les opérations sur les objets groupby</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#apply-une-methode-importante-pour-manipuler-vos-groupby">4.5.3 Apply : une méthode importante pour manipuler vos groupby</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cas-concret-dutilisation-dun-groupby">4.5.4 Cas concret d’utilisation d’un groupby</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>